<?xml version="1.0" encoding="ascii" ?>

<script language="javascript" type="text/javascript">

function astext(node)
{
    return node.innerHTML.replace(/(<([^>]+)>)/ig,"")
                         .replace(/&gt;/ig, ">")
                         .replace(/&lt;/ig, "<")
                         .replace(/&quot;/ig, '"')
                         .replace(/&amp;/ig, "&");
}

function copy_notify(node, bar_color, data)
{
    // The outer box: relative + inline positioning.
    var box1 = document.createElement("div");
    box1.style.position = "relative";
    box1.style.display = "inline";
    box1.style.top = "2em";
    box1.style.left = "1em";
  
    // A shadow for fun
    var shadow = document.createElement("div");
    shadow.style.position = "absolute";
    shadow.style.left = "-1.3em";
    shadow.style.top = "-1.3em";
    shadow.style.background = "#404040";
    
    // The inner box: absolute positioning.
    var box2 = document.createElement("div");
    box2.style.position = "relative";
    box2.style.border = "1px solid #a0a0a0";
    box2.style.left = "-.2em";
    box2.style.top = "-.2em";
    box2.style.background = "white";
    box2.style.padding = ".3em .4em .3em .4em";
    box2.style.fontStyle = "normal";
    box2.style.background = "#f0e0e0";

    node.insertBefore(box1, node.childNodes.item(0));
    box1.appendChild(shadow);
    shadow.appendChild(box2);
    box2.innerHTML="Copied&nbsp;to&nbsp;the&nbsp;clipboard: " +
                   "<pre class='copy-notify'>"+
                   data+"</pre>";
    setTimeout(function() { node.removeChild(box1); }, 1000);

    var elt = node.parentNode.firstChild;
    elt.style.background = "#ffc0c0";
    setTimeout(function() { elt.style.background = bar_color; }, 200);
}

function copy_codeblock_to_clipboard(node)
{
    var data = astext(node)+"\n";
    if (copy_text_to_clipboard(data)) {
        copy_notify(node, "#40a060", data);
    }
}

function copy_doctest_to_clipboard(node)
{
    var s = astext(node)+"\n   ";
    var data = "";

    var start = 0;
    var end = s.indexOf("\n");
    while (end >= 0) {
        if (s.substring(start, start+4) == ">>> ") {
            data += s.substring(start+4, end+1);
        }
        else if (s.substring(start, start+4) == "... ") {
            data += s.substring(start+4, end+1);
        }
        /*
        else if (end-start > 1) {
            data += "# " + s.substring(start, end+1);
        }*/
        // Grab the next line.
        start = end+1;
        end = s.indexOf("\n", start);
    }
    
    if (copy_text_to_clipboard(data)) {
        copy_notify(node, "#4060a0", data);
    }
}
    
function copy_text_to_clipboard(data)
{
    if (window.clipboardData) {
        window.clipboardData.setData("Text", data);
        return true;
     }
    else if (window.netscape) {
        // w/ default firefox settings, permission will be denied for this:
        netscape.security.PrivilegeManager
                      .enablePrivilege("UniversalXPConnect");
    
        var clip = Components.classes["@mozilla.org/widget/clipboard;1"]
                      .createInstance(Components.interfaces.nsIClipboard);
        if (!clip) return;
    
        var trans = Components.classes["@mozilla.org/widget/transferable;1"]
                       .createInstance(Components.interfaces.nsITransferable);
        if (!trans) return;
    
        trans.addDataFlavor("text/unicode");
    
        var str = new Object();
        var len = new Object();
    
        var str = Components.classes["@mozilla.org/supports-string;1"]
                     .createInstance(Components.interfaces.nsISupportsString);
        var datacopy=data;
        str.data=datacopy;
        trans.setTransferData("text/unicode",str,datacopy.length*2);
        var clipid=Components.interfaces.nsIClipboard;
    
        if (!clip) return false;
    
        clip.setData(trans,null,clipid.kGlobalClipboard);
        return true;
    }
    return false;
}
//-->
</script>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ascii" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>Feature Structures &amp; Unification</title>
<style type="text/css">

/*
:Author: Edward Loper, James Curran
:Copyright: This stylesheet has been placed in the public domain.

Stylesheet for use with Docutils.

This stylesheet defines new css classes used by NLTK.

It uses a Python syntax highlighting scheme that matches
the colour scheme used by IDLE, which makes it easier for
beginners to check they are typing things in correctly.
*/

/* Include the standard docutils stylesheet. */
@import url(default.css);

/* Custom inline roles */
span.placeholder    { font-style: italic; font-family: monospace; }
span.example        { font-style: italic; }
span.emphasis       { font-style: italic; }
span.termdef        { font-weight: bold; }
/*span.term           { font-style: italic; }*/
span.category       { font-variant: small-caps; }
span.feature        { font-variant: small-caps; }
span.fval           { font-style: italic; }
span.math           { font-style: italic; }
span.mathit         { font-style: italic; }
span.lex            { font-variant: small-caps; }
span.guide-linecount{ text-align: right; display: block;}

/* Python souce code listings */
span.pysrc-prompt   { color: #9b0000; }
span.pysrc-more     { color: #9b00ff; }
span.pysrc-keyword  { color: #e06000; }
span.pysrc-builtin  { color: #940094; }
span.pysrc-string   { color: #00aa00; }
span.pysrc-comment  { color: #ff0000; }
span.pysrc-output   { color: #0000ff; }
span.pysrc-except   { color: #ff0000; }
span.pysrc-defname  { color: #008080; }


/* Doctest blocks */
pre.doctest         { margin: 0; padding: 0; font-weight: bold; }
div.doctest         { margin: 0 1em 1em 1em; padding: 0; }
table.doctest       { margin: 0; padding: 0;
                      border-top: 1px solid gray;
                      border-bottom: 1px solid gray; }
pre.copy-notify     { margin: 0; padding: 0.2em; font-weight: bold;
                      background-color: #ffffff; }

/* Python source listings */
div.pylisting       { margin: 0 1em 1em 1em; padding: 0; }
table.pylisting     { margin: 0; padding: 0;
                      border-top: 1px solid gray; }
td.caption { border-top: 1px solid black; margin: 0; padding: 0; }
.caption-label { font-weight: bold;  }
td.caption p { margin: 0; padding: 0; font-style: normal;}

table tr td.codeblock { 
  padding: 0.2em ! important; margin: 0;
  border-left: 1px solid gray;
  border-right: 2px solid gray;
  border-top: 0px solid gray;
  border-bottom: 1px solid gray;
  font-weight: bold; background-color: #eeffee;
}

table tr td.doctest  { 
  padding: 0.2em; margin: 0;
  border-left: 1px solid gray;
  border-right: 2px solid gray;
  border-top: 0px solid gray;
  border-bottom: 1px solid gray;
  font-weight: bold; background-color: #eeeeff;
}

td.codeblock table tr td.copybar {
    background: #40a060; border: 1px solid gray;
    font-family: monospace; padding: 0; margin: 0; }
td.doctest table tr td.copybar {
    background: #4060a0; border: 1px solid gray;
    font-family: monospace; padding: 0; margin: 0; }

td.pysrc { padding-left: 0.5em; }

img.callout { border-width: 0px; }

table.docutils {
    border-style: solid;
    border-width: 1px;
    margin-top: 6px;
    border-color: grey;
    border-collapse: collapse; }

table.docutils th {
    border-style: none;
    border-width: 1px;
    border-color: grey;
    padding: 0 .5em 0 .5em; }

table.docutils td {
    border-style: none;
    border-width: 1px;
    border-color: grey; 
    padding: 0 .5em 0 .5em; }

table.footnote td { padding: 0; }
table.footnote { border-width: 0; }
table.footnote td { border-width: 0; }
table.footnote th { border-width: 0; }

table.noborder { border-width: 0; }

table.example pre { margin-top: 4px; margin-bottom: 0; }

/* For figures & tables */
p.caption { margin-bottom: 0; }
div.figure { text-align: center; }

/* The index */
div.index { border: 1px solid black;
            background-color: #eeeeee; }
div.index h1 { padding-left: 0.5em; margin-top: 0.5ex;
               border-bottom: 1px solid black; }
ul.index { margin-left: 0.5em; padding-left: 0; }
li.index { list-style-type: none; }
p.index-heading { font-size: 120%; font-style: italic; margin: 0; }
li.index ul { margin-left: 2em; padding-left: 0; }

/* 'Note' callouts */
div.note
{
  border-right:   #87ceeb 1px solid;
  padding-right: 4px;
  border-top: #87ceeb 1px solid;
  padding-left: 4px;
  padding-bottom: 4px;
  margin: 2px 5% 10px;
  border-left: #87ceeb 1px solid;
  padding-top: 4px;
  border-bottom: #87ceeb 1px solid;
  font-style: normal;
  font-family: verdana, arial;
  background-color: #b0c4de;
}

table.avm { border: 0px solid black; width: 0; }
table.avm tbody tr {border: 0px solid black; }
table.avm tbody tr td { padding: 2px; }
table.avm tbody tr td.avm-key { padding: 5px; font-variant: small-caps; }
table.avm tbody tr td.avm-eq { padding: 5px; }
table.avm tbody tr td.avm-val { padding: 5px; font-style: italic; }
p.avm-empty { font-style: normal; }
table.avm colgroup col { border: 0px solid black; }
table.avm tbody tr td.avm-topleft 
    { border-left: 2px solid #000080; border-top: 2px solid #000080; }
table.avm tbody tr td.avm-botleft 
    { border-left: 2px solid #000080; border-bottom: 2px solid #000080; }
table.avm tbody tr td.avm-topright
    { border-right: 2px solid #000080; border-top: 2px solid #000080; }
table.avm tbody tr td.avm-botright
    { border-right: 2px solid #000080; border-bottom: 2px solid #000080; }
table.avm tbody tr td.avm-left
    { border-left: 2px solid #000080; }
table.avm tbody tr td.avm-right
    { border-right: 2px solid #000080; }
table.avm tbody tr td.avm-topbotleft
    { border: 2px solid #000080; border-right: 0px solid black; }
table.avm tbody tr td.avm-topbotright
    { border: 2px solid #000080; border-left: 0px solid black; }
table.avm tbody tr td.avm-ident
    { font-size: 80%; padding: 0; padding-left: 2px; vertical-align: top; }
.avm-pointer
{ border: 1px solid #008000; padding: 1px; color: #008000; 
  background: #c0ffc0; font-style: normal; }

table.gloss { border: 0px solid black; width: 0; }
table.gloss tbody tr { border: 0px solid black; }
table.gloss tbody tr td { border: 0px solid black; }
table.gloss colgroup col { border: 0px solid black; }
table.gloss p { margin: 0; padding: 0; }

table.rst-example { border: 1px solid black; }
table.rst-example tbody tr td { background: #eeeeee; }
table.rst-example thead tr th { background: #c0ffff; }
td.rst-raw { width: 0; }

/* Used by nltk.org/doc/test: */
div.doctest-list { text-align: center; }
table.doctest-list { border: 1px solid black;
  margin-left: auto; margin-right: auto;
}
table.doctest-list tbody tr td { background: #eeeeee;
  border: 1px solid #cccccc; text-align: left; }
table.doctest-list thead tr th { background: #304050; color: #ffffff;
  border: 1px solid #000000;}
table.doctest-list thead tr a { color: #ffffff; }
span.doctest-passed { color: #008000; }
span.doctest-failed { color: #800000; }

</style>
</head>
<body>
<div class="document" id="feature-structures-unification">
<h1 class="title">Feature Structures &amp; Unification</h1>

<!-- Copyright (C) 2001-2014 NLTK Project -->
<!-- For license information, see LICENSE.TXT -->
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> __future__ <span class="pysrc-keyword">import</span> print_function
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> FeatStruct
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.sem.logic <span class="pysrc-keyword">import</span> Variable, VariableExpression, Expression</pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">For now, featstruct uses the older lambdalogic semantics
module.  Eventually, it should be updated to use the new first
order predicate logic module.</p>
</div>
<div class="section" id="overview">
<h1>1&nbsp;&nbsp;&nbsp;Overview</h1>
<p>A feature structure is a mapping from feature identifiers to feature
values, where feature values can be simple values (like strings or
ints), nested feature structures, or variables:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(number=<span class="pysrc-string">'singular'</span>, person=3)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1)
<span class="pysrc-output">[ number = 'singular' ]</span>
<span class="pysrc-output">[ person = 3          ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature structure may be nested:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(type=<span class="pysrc-string">'NP'</span>, agr=fs1)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs2)
<span class="pysrc-output">[ agr  = [ number = 'singular' ] ]</span>
<span class="pysrc-output">[        [ person = 3          ] ]</span>
<span class="pysrc-output">[                                ]</span>
<span class="pysrc-output">[ type = 'NP'                    ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Variables are used to indicate that two features should be assigned
the same value.  For example, the following feature structure requires
that the feature fs3['agr']['number'] be bound to the same value as the
feature fs3['subj']['number'].</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = FeatStruct(agr=FeatStruct(number=Variable(<span class="pysrc-string">'?n'</span>)),
<span class="pysrc-more">... </span>                 subj=FeatStruct(number=Variable(<span class="pysrc-string">'?n'</span>)))
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs3)
<span class="pysrc-output">[ agr  = [ number = ?n ] ]</span>
<span class="pysrc-output">[                        ]</span>
<span class="pysrc-output">[ subj = [ number = ?n ] ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature structures are typically used to represent partial information
about objects.  A feature name that is not mapped to a value stands
for a feature whose value is unknown (<em>not</em> a feature without a
value).  Two feature structures that represent (potentially
overlapping) information about the same object can be combined by
<em>unification</em>.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs2.unify(fs3))
<span class="pysrc-output">[ agr  = [ number = 'singular' ] ]</span>
<span class="pysrc-output">[        [ person = 3          ] ]</span>
<span class="pysrc-output">[                                ]</span>
<span class="pysrc-output">[ subj = [ number = 'singular' ] ]</span>
<span class="pysrc-output">[                                ]</span>
<span class="pysrc-output">[ type = 'NP'                    ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>When two inconsistent feature structures are unified, the unification
fails and returns <tt class="doctest"><span class="pre">None</span></tt>.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs4 = FeatStruct(agr=FeatStruct(person=1))
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs4.unify(fs2))
<span class="pysrc-output">None</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs2.unify(fs4))
<span class="pysrc-output">None</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2, fs3, fs4 # clean-up -->
<div class="section" id="feature-structure-types">
<h2>1.1&nbsp;&nbsp;&nbsp;Feature Structure Types</h2>
<p>There are actually two types of feature structure:</p>
<ul class="simple">
<li><em>feature dictionaries</em>, implemented by <cite>FeatDict</cite>, act like
Python dictionaries.  Feature identifiers may be strings or
instances of the <cite>Feature</cite> class.</li>
<li><em>feature lists</em>, implemented by <cite>FeatList</cite>, act like Python
lists.  Feature identifiers are integers.</li>
</ul>
<p>When you construct a feature structure using the <cite>FeatStruct</cite>
constructor, it will automatically decide which type is appropriate:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>type(FeatStruct(number=<span class="pysrc-string">'singular'</span>))
<span class="pysrc-output">&lt;class 'nltk.featstruct.FeatDict'&gt;</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>type(FeatStruct([1,2,3]))
<span class="pysrc-output">&lt;class 'nltk.featstruct.FeatList'&gt;</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Usually, we will just use feature dictionaries; but sometimes feature
lists can be useful too.  Two feature lists will unify with each other
only if they have equal lengths, and all of their feature values
match.  If you wish to write a feature list that contains 'unknown'
values, you must use variables:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct([1,2,Variable(<span class="pysrc-string">'?y'</span>)])
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct([1,Variable(<span class="pysrc-string">'?x'</span>),3])
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[1, 2, 3]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
<div class="section" id="parsing-feature-structure-strings">
<h2>1.2&nbsp;&nbsp;&nbsp;Parsing Feature Structure Strings</h2>
<p>Feature structures can be constructed directly from strings.  Often,
this is more convenient than constructing them directly.  NLTK can
parse most feature strings to produce the corresponding feature
structures.  (But you must restrict your base feature values to
strings, ints, logic expressions (<cite>nltk.sem.logic.Expression</cite>), and a
few other types discussed below).</p>
<p>Feature dictionaries are written like Python dictionaries, except that
keys are not put in quotes; and square brackets (<tt class="doctest"><span class="pre">[]</span></tt>) are used
instead of braces (<tt class="doctest"><span class="pre">{}</span></tt>):</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[tense=&quot;past&quot;, agr=[number=&quot;sing&quot;, person=3]]'</span>)
<span class="pysrc-output">[agr=[number='sing', person=3], tense='past']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>If a feature value is a single alphanumeric word, then it does not
need to be quoted -- it will be automatically treated as a string:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[tense=past, agr=[number=sing, person=3]]'</span>)
<span class="pysrc-output">[agr=[number='sing', person=3], tense='past']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature lists are written like python lists:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[1, 2, 3]'</span>)
<span class="pysrc-output">[1, 2, 3]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>The expression <tt class="doctest"><span class="pre">[]</span></tt> is treated as an empty feature dictionary, not
an empty feature list:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>type(FeatStruct(<span class="pysrc-string">'[]'</span>))
<span class="pysrc-output">&lt;class 'nltk.featstruct.FeatDict'&gt;</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
<div class="section" id="feature-paths">
<h2>1.3&nbsp;&nbsp;&nbsp;Feature Paths</h2>
<p>Features can be specified using <em>feature paths</em>, or tuples of feature
identifiers that specify path through the nested feature structures to
a value.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=1, y=[1,2,[z=3]]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'y'</span>]
<span class="pysrc-output">[1, 2, [z=3]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'y'</span>, 2]
<span class="pysrc-output">[z=3]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'y'</span>, 2, <span class="pysrc-string">'z'</span>]
<span class="pysrc-output">3</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1 # clean-up -->
</div>
<div class="section" id="reentrance">
<h2>1.4&nbsp;&nbsp;&nbsp;Reentrance</h2>
<p>Feature structures may contain reentrant feature values.  A <em>reentrant
feature value</em> is a single feature structure that can be accessed via
multiple feature paths.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(x=<span class="pysrc-string">'val'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(a=fs1, b=fs1)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs2)
<span class="pysrc-output">[ a = (1) [ x = 'val' ] ]</span>
<span class="pysrc-output">[                       ]</span>
<span class="pysrc-output">[ b -&gt; (1)              ]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[a=(1)[x='val'], b-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>As you can see, reentrane is displayed by marking a feature structure
with a unique identifier, in this case <tt class="doctest"><span class="pre">(1)</span></tt>, the first time it is
encountered; and then using the special form <tt class="doctest"><span class="pre">var -&gt; id</span></tt> whenever it
is encountered again.  You can use the same notation to directly
create reentrant feature structures from strings.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=(1)[], b-&gt;(1), c=[d-&gt;(1)]]'</span>)
<span class="pysrc-output">[a=(1)[], b-&gt;(1), c=[d-&gt;(1)]]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Reentrant feature structures may contain cycles:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = FeatStruct(<span class="pysrc-string">'(1)[a-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>]
<span class="pysrc-output">(1)[a-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'a'</span>] <span class="pysrc-keyword">is</span> fs3
<span class="pysrc-output">True</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Unification preserves the reentrance relations imposed by both of the
unified feature structures.  In the feature structure resulting from
unification, any modifications to a reentrant feature value will be
visible using any of its feature paths.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3.unify(FeatStruct(<span class="pysrc-string">'[a=[b=12], c=33]'</span>))
<span class="pysrc-output">(1)[a-&gt;(1), b=12, c=33]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2, fs3 # clean-up -->
</div>
<div class="section" id="feature-structure-equality">
<h2>1.5&nbsp;&nbsp;&nbsp;Feature Structure Equality</h2>
<p>Two feature structures are considered equal if they assign the same
values to all features, <em>and</em> they contain the same reentrances.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=(1)[x=1], b-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=(1)[x=1], b-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = FeatStruct(<span class="pysrc-string">'[a=[x=1], b=[x=1]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 == fs1, fs1 <span class="pysrc-keyword">is</span> fs1
<span class="pysrc-output">(True, True)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 == fs2, fs1 <span class="pysrc-keyword">is</span> fs2
<span class="pysrc-output">(True, False)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 == fs3, fs1 <span class="pysrc-keyword">is</span> fs3
<span class="pysrc-output">(False, False)</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Note that this differs from how Python dictionaries and lists define
equality -- in particular, Python dictionaries and lists ignore
reentrance relations.  To test two feature structures for equality
while ignoring reentrance relations, use the <cite>equal_values()</cite> method:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.equal_values(fs1)
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.equal_values(fs2)
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.equal_values(fs3)
<span class="pysrc-output">True</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2, fs3 # clean-up -->
</div>
<div class="section" id="feature-value-sets-feature-value-tuples">
<h2>1.6&nbsp;&nbsp;&nbsp;Feature Value Sets &amp; Feature Value Tuples</h2>
<p><cite>nltk.featstruct</cite> defines two new data types that are intended to be
used as feature values: <cite>FeatureValueTuple</cite> and <cite>FeatureValueSet</cite>.
Both of these types are considered base values -- i.e., unification
does <em>not</em> apply to them.  However, variable binding <em>does</em> apply to
any values that they contain.</p>
<p>Feature value tuples are written with parentheses:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=(?x, ?y)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[x=(?x, ?y)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.substitute_bindings({Variable(<span class="pysrc-string">'?x'</span>): 1, Variable(<span class="pysrc-string">'?y'</span>): 2})
<span class="pysrc-output">[x=(1, 2)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature sets are written with braces:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x={?x, ?y}]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[x={?x, ?y}]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.substitute_bindings({Variable(<span class="pysrc-string">'?x'</span>): 1, Variable(<span class="pysrc-string">'?y'</span>): 2})
<span class="pysrc-output">[x={1, 2}]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>In addition to the basic feature value tuple &amp; set classes, nltk
defines feature value unions (for sets) and feature value
concatenations (for tuples).  These are written using '+', and can be
used to combine sets &amp; tuples:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=((1, 2)+?z), z=?z]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[x=((1, 2)+?z), z=?z]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(FeatStruct(<span class="pysrc-string">'[z=(3, 4, 5)]'</span>))
<span class="pysrc-output">[x=(1, 2, 3, 4, 5), z=(3, 4, 5)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Thus, feature value tuples and sets can be used to build up tuples
and sets of values over the corse of unification.  For example, when
parsing sentences using a semantic feature grammar, feature sets or
feature tuples can be used to build a list of semantic predicates as
the sentence is parsed.</p>
<p>As was mentioned above, unification does not apply to feature value
tuples and sets.  One reason for this that it's impossible to define a
single correct answer for unification when concatenation is used.
Consider the following example:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=(1, 2, 3, 4)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[x=(?a+?b), a=?a, b=?b]'</span>)</pre>
</td>
</tr></table></td></tr>
</table></div>
<p>If unification applied to feature tuples, then the unification
algorithm would have to arbitrarily choose how to divide the tuple
(1,2,3,4) into two parts.  Instead, the unification algorithm refuses
to make this decision, and simply unifies based on value.  Because
(1,2,3,4) is not equal to (?a+?b), fs1 and fs2 will not unify:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(fs2))
<span class="pysrc-output">None</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>If you need a list-like structure that unification does apply to, use
<cite>FeatList</cite>.</p>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
<div class="section" id="light-weight-feature-structures">
<h2>1.7&nbsp;&nbsp;&nbsp;Light-weight Feature Structures</h2>
<p>Many of the functions defined by <cite>nltk.featstruct</cite> can be applied
directly to simple Python dictionaries and lists, rather than to
full-fledged <cite>FeatDict</cite> and <cite>FeatList</cite> objects.  In other words,
Python <tt class="doctest"><span class="pre">dicts</span></tt> and <tt class="doctest"><span class="pre">lists</span></tt> can be used as &quot;light-weight&quot; feature
structures.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-comment"># Note: pprint prints dicts sorted</span>
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> pprint <span class="pysrc-keyword">import</span> pprint
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> unify
<span class="pysrc-prompt">&gt;&gt;&gt; </span>pprint(unify(dict(x=1, y=dict()), dict(a=<span class="pysrc-string">'a'</span>, y=dict(b=<span class="pysrc-string">'b'</span>))))
<span class="pysrc-output">{'a': 'a', 'x': 1, 'y': {'b': 'b'}}</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>However, you should keep in mind the following caveats:</p>
<ul class="simple">
<li>Python dictionaries &amp; lists ignore reentrance when checking for
equality between values.  But two FeatStructs with different
reentrances are considered nonequal, even if all their base
values are equal.</li>
<li>FeatStructs can be easily frozen, allowing them to be used as
keys in hash tables.  Python dictionaries and lists can not.</li>
<li>FeatStructs display reentrance in their string representations;
Python dictionaries and lists do not.</li>
<li>FeatStructs may <em>not</em> be mixed with Python dictionaries and lists
(e.g., when performing unification).</li>
<li>FeatStructs provide a number of useful methods, such as <cite>walk()</cite>
and <cite>cyclic()</cite>, which are not available for Python dicts &amp; lists.</li>
</ul>
<p>In general, if your feature structures will contain any reentrances,
or if you plan to use them as dictionary keys, it is strongly
recommended that you use full-fledged <cite>FeatStruct</cite> objects.</p>
</div>
<div class="section" id="custom-feature-values">
<h2>1.8&nbsp;&nbsp;&nbsp;Custom Feature Values</h2>
<p>The abstract base class <cite>CustomFeatureValue</cite> can be used to define new
base value types that have custom unification methods.  For example,
the following feature value type encodes a range, and defines
unification as taking the intersection on the ranges:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.compat <span class="pysrc-keyword">import</span> total_ordering
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> CustomFeatureValue, UnificationFailure
<span class="pysrc-prompt">&gt;&gt;&gt; </span>&#64;total_ordering
<span class="pysrc-more">... </span><span class="pysrc-keyword">class</span> <span class="pysrc-defname">Range</span>(CustomFeatureValue):
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">def</span> <span class="pysrc-defname">__init__</span>(self, low, high):
<span class="pysrc-more">... </span>        assert low &lt;= high
<span class="pysrc-more">... </span>        self.low = low
<span class="pysrc-more">... </span>        self.high = high
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">def</span> <span class="pysrc-defname">unify</span>(self, other):
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">if</span> <span class="pysrc-keyword">not</span> isinstance(other, Range):
<span class="pysrc-more">... </span>            return UnificationFailure
<span class="pysrc-more">... </span>        low = max(self.low, other.low)
<span class="pysrc-more">... </span>        high = min(self.high, other.high)
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">if</span> low &lt;= high: return Range(low, high)
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">else</span>: return UnificationFailure
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">def</span> <span class="pysrc-defname">__repr__</span>(self):
<span class="pysrc-more">... </span>        return <span class="pysrc-string">'(%s&lt;x&lt;%s)'</span> % (self.low, self.high)
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">def</span> <span class="pysrc-defname">__eq__</span>(self, other):
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">if</span> <span class="pysrc-keyword">not</span> isinstance(other, Range):
<span class="pysrc-more">... </span>            return False
<span class="pysrc-more">... </span>        return (self.low == other.low) <span class="pysrc-keyword">and</span> (self.high == other.high)
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">def</span> <span class="pysrc-defname">__lt__</span>(self, other):
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">if</span> <span class="pysrc-keyword">not</span> isinstance(other, Range):
<span class="pysrc-more">... </span>            return True
<span class="pysrc-more">... </span>        return (self.low, self.high) &lt; (other.low, other.high)</pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(x=Range(5,8), y=FeatStruct(z=Range(7,22)))
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(FeatStruct(x=Range(6, 22))))
<span class="pysrc-output">[ x = (6&lt;x&lt;8)          ]</span>
<span class="pysrc-output">[                      ]</span>
<span class="pysrc-output">[ y = [ z = (7&lt;x&lt;22) ] ]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(FeatStruct(x=Range(9, 12))))
<span class="pysrc-output">None</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(FeatStruct(x=12)))
<span class="pysrc-output">None</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(FeatStruct(<span class="pysrc-string">'[x=?x, y=[z=?x]]'</span>)))
<span class="pysrc-output">[ x = (7&lt;x&lt;8)         ]</span>
<span class="pysrc-output">[                     ]</span>
<span class="pysrc-output">[ y = [ z = (7&lt;x&lt;8) ] ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
</div>
<div class="section" id="regression-tests">
<h1>2&nbsp;&nbsp;&nbsp;Regression Tests</h1>
<div class="section" id="dictionary-access-methods-non-mutating">
<h2>2.1&nbsp;&nbsp;&nbsp;Dictionary access methods (non-mutating)</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(a=1, b=2, c=3)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(x=fs1, y=<span class="pysrc-string">'x'</span>)</pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature structures support all dictionary methods (excluding the class
method <cite>dict.fromkeys()</cite>).  Non-mutating methods:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted(fs2.keys())                               <span class="pysrc-comment"># keys()</span>
<span class="pysrc-output">['x', 'y']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted(fs2.values())                             <span class="pysrc-comment"># values()</span>
<span class="pysrc-output">[[a=1, b=2, c=3], 'x']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted(fs2.items())                              <span class="pysrc-comment"># items()</span>
<span class="pysrc-output">[('x', [a=1, b=2, c=3]), ('y', 'x')]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted(fs2)                                      <span class="pysrc-comment"># __iter__()</span>
<span class="pysrc-output">['x', 'y']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-string">'a'</span> <span class="pysrc-keyword">in</span> fs2, <span class="pysrc-string">'x'</span> <span class="pysrc-keyword">in</span> fs2                           <span class="pysrc-comment"># __contains__()</span>
<span class="pysrc-output">(False, True)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.has_key(<span class="pysrc-string">'a'</span>), fs2.has_key(<span class="pysrc-string">'x'</span>)               <span class="pysrc-comment"># has_key()</span>
<span class="pysrc-output">(False, True)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'x'</span>], fs2[<span class="pysrc-string">'y'</span>]                               <span class="pysrc-comment"># __getitem__()</span>
<span class="pysrc-output">([a=1, b=2, c=3], 'x')</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'a'</span>]                                         <span class="pysrc-comment"># __getitem__()</span>
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">KeyError: 'a'</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.get(<span class="pysrc-string">'x'</span>), fs2.get(<span class="pysrc-string">'y'</span>), fs2.get(<span class="pysrc-string">'a'</span>)         <span class="pysrc-comment"># get()</span>
<span class="pysrc-output">([a=1, b=2, c=3], 'x', None)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.get(<span class="pysrc-string">'x'</span>, <span class="pysrc-string">'hello'</span>), fs2.get(<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'hello'</span>)     <span class="pysrc-comment"># get()</span>
<span class="pysrc-output">([a=1, b=2, c=3], 'hello')</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>len(fs1), len(fs2)                               <span class="pysrc-comment"># __len__</span>
<span class="pysrc-output">(3, 2)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.copy()                                       <span class="pysrc-comment"># copy()</span>
<span class="pysrc-output">[x=[a=1, b=2, c=3], y='x']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.copy() <span class="pysrc-keyword">is</span> fs2                                <span class="pysrc-comment"># copy()</span>
<span class="pysrc-output">False</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Note: by default, <cite>FeatStruct.copy()</cite> does a deep copy.  Use
<cite>FeatStruct.copy(deep=False)</cite> for a shallow copy.</p>
<!-- >>> del fs1, fs2 # clean-up. -->
</div>
<div class="section" id="dictionary-access-methods-mutating">
<h2>2.2&nbsp;&nbsp;&nbsp;Dictionary access methods (mutating)</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(a=1, b=2, c=3)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(x=fs1, y=<span class="pysrc-string">'x'</span>)</pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Setting features (<cite>__setitem__()</cite>)</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'c'</span>] = 5
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[a=1, b=2, c=5]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'x'</span>] = 12
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[a=1, b=2, c=5, x=12]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'x'</span>, <span class="pysrc-string">'a'</span>] = 2
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[x=[a=2, b=2, c=5, x=12], y='x']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[a=2, b=2, c=5, x=12]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Deleting features (<cite>__delitem__()</cite>)</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">del</span> fs1[<span class="pysrc-string">'x'</span>]
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[a=2, b=2, c=5]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">del</span> fs2[<span class="pysrc-string">'x'</span>, <span class="pysrc-string">'a'</span>]
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[b=2, c=5]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p><cite>setdefault()</cite>:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.setdefault(<span class="pysrc-string">'b'</span>, 99)
<span class="pysrc-output">2</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[b=2, c=5]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.setdefault(<span class="pysrc-string">'x'</span>, 99)
<span class="pysrc-output">99</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[b=2, c=5, x=99]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p><cite>update()</cite>:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.update({<span class="pysrc-string">'a'</span>:<span class="pysrc-string">'A'</span>, <span class="pysrc-string">'b'</span>:<span class="pysrc-string">'B'</span>}, c=<span class="pysrc-string">'C'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[a='A', b='B', c='C', x=[b=2, c=5, x=99], y='x']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p><cite>pop()</cite>:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.pop(<span class="pysrc-string">'a'</span>)
<span class="pysrc-output">'A'</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[b='B', c='C', x=[b=2, c=5, x=99], y='x']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.pop(<span class="pysrc-string">'a'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">KeyError: 'a'</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.pop(<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'foo'</span>)
<span class="pysrc-output">'foo'</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[b='B', c='C', x=[b=2, c=5, x=99], y='x']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p><cite>clear()</cite>:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.clear()
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1
<span class="pysrc-output">[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[b='B', c='C', x=[], y='x']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p><cite>popitem()</cite>:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted([fs2.popitem() <span class="pysrc-keyword">for</span> i <span class="pysrc-keyword">in</span> range(len(fs2))])
<span class="pysrc-output">[('b', 'B'), ('c', 'C'), ('x', []), ('y', 'x')]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2
<span class="pysrc-output">[]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Once a feature structure has been frozen, it may not be mutated.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=1, y=2, z=[a=3]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.freeze()
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.frozen()
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'z'</span>].frozen()
<span class="pysrc-output">True</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'x'</span>] = 5
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">del</span> fs1[<span class="pysrc-string">'x'</span>]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.clear()
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.pop(<span class="pysrc-string">'x'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.popitem()
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.setdefault(<span class="pysrc-string">'x'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.update(z=22)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Frozen FeatStructs may not be modified.</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up. -->
</div>
<div class="section" id="id1">
<h2>2.3&nbsp;&nbsp;&nbsp;Feature Paths</h2>
<p>Make sure that __getitem__ with feature paths works as intended:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(a=1, b=2,
<span class="pysrc-more">... </span>                c=FeatStruct(
<span class="pysrc-more">... </span>                    d=FeatStruct(e=12),
<span class="pysrc-more">... </span>                    f=FeatStruct(g=55, h=<span class="pysrc-string">'hello'</span>)))
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[()]
<span class="pysrc-output">[a=1, b=2, c=[d=[e=12], f=[g=55, h='hello']]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'a'</span>], fs1[(<span class="pysrc-string">'a'</span>,)]
<span class="pysrc-output">(1, 1)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'c'</span>,<span class="pysrc-string">'d'</span>,<span class="pysrc-string">'e'</span>]
<span class="pysrc-output">12</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'c'</span>,<span class="pysrc-string">'f'</span>,<span class="pysrc-string">'g'</span>]
<span class="pysrc-output">55</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature paths that select unknown features raise KeyError:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'c'</span>, <span class="pysrc-string">'f'</span>, <span class="pysrc-string">'e'</span>]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">KeyError: ('c', 'f', 'e')</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'q'</span>, <span class="pysrc-string">'p'</span>]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">KeyError: ('q', 'p')</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature paths that try to go 'through' a feature that's not a feature
structure raise KeyError:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1[<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'b'</span>]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">KeyError: ('a', 'b')</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature paths can go through reentrant structures:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'(1)[a=[b=[c-&gt;(1), d=5], e=11]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'b'</span>, <span class="pysrc-string">'c'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'e'</span>]
<span class="pysrc-output">11</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'a'</span>, <span class="pysrc-string">'b'</span>, <span class="pysrc-string">'c'</span>, <span class="pysrc-string">'a'</span>, <span class="pysrc-string">'b'</span>, <span class="pysrc-string">'d'</span>]
<span class="pysrc-output">5</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[tuple(<span class="pysrc-string">'abcabcabcabcabcabcabcabcabcabca'</span>)]
<span class="pysrc-output">(1)[b=[c=[a-&gt;(1)], d=5], e=11]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Indexing requires strings, <cite>Feature</cite>s, or tuples; other types raise a
TypeError:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[12]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">TypeError: Expected feature name or path.  Got 12.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[list(<span class="pysrc-string">'abc'</span>)]
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">TypeError: Expected feature name or path.  Got ['a', 'b', 'c'].</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature paths can also be used with <cite>get()</cite>, <cite>has_key()</cite>, and
<cite>__contains__()</cite>.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fpath1 = tuple(<span class="pysrc-string">'abcabc'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fpath2 = tuple(<span class="pysrc-string">'abcabz'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.get(fpath1), fs2.get(fpath2)
<span class="pysrc-output">((1)[a=[b=[c-&gt;(1), d=5], e=11]], None)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fpath1 <span class="pysrc-keyword">in</span> fs2, fpath2 <span class="pysrc-keyword">in</span> fs2
<span class="pysrc-output">(True, False)</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.has_key(fpath1), fs2.has_key(fpath2)
<span class="pysrc-output">(True, False)</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
<div class="section" id="reading-feature-structures">
<h2>2.4&nbsp;&nbsp;&nbsp;Reading Feature Structures</h2>
<p>Empty feature struct:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[]'</span>)
<span class="pysrc-output">[]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Test features with integer values:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=12, b=-33, c=0]'</span>)
<span class="pysrc-output">[a=12, b=-33, c=0]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Test features with string values.  Either single or double quotes may
be used.  Strings are evaluated just like python strings -- in
particular, you can use escape sequences and 'u' and 'r' prefixes, and
triple-quoted strings.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=&quot;&quot;, b=&quot;hello&quot;, c=&quot;\'&quot;, d=\'\', e=\'&quot;\']'</span>)
<span class="pysrc-output">[a='', b='hello', c=&quot;'&quot;, d='', e='&quot;']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(r<span class="pysrc-string">'[a=&quot;\\&quot;, b=&quot;\&quot;&quot;, c=&quot;\x6f\\y&quot;, d=&quot;12&quot;]'</span>)
<span class="pysrc-output">[a='\\', b='&quot;', c='o\\y', d='12']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(r<span class="pysrc-string">'[b=r&quot;a\b\c&quot;]'</span>)
<span class="pysrc-output">[b='a\\b\\c']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x=&quot;&quot;&quot;a&quot;&quot;&quot;]'</span>)
<span class="pysrc-output">[x='a']</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Test parsing of reentrant feature structures.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=(1)[], b-&gt;(1)]'</span>)
<span class="pysrc-output">[a=(1)[], b-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=(1)[x=1, y=2], b-&gt;(1)]'</span>)
<span class="pysrc-output">[a=(1)[x=1, y=2], b-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Test parsing of cyclic feature structures.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=(1)[b-&gt;(1)]]'</span>)
<span class="pysrc-output">[a=(1)[b-&gt;(1)]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'(1)[a=[b=[c-&gt;(1)]]]'</span>)
<span class="pysrc-output">(1)[a=[b=[c-&gt;(1)]]]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Strings of the form &quot;+name&quot; and &quot;-name&quot; may be used to specify boolean
values.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[-bar, +baz, +foo]'</span>)
<span class="pysrc-output">[-bar, +baz, +foo]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>None, True, and False are recognized as values:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[bar=True, baz=False, foo=None]'</span>)
<span class="pysrc-output">[+bar, -baz, foo=None]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Special features:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'NP/VP'</span>)
<span class="pysrc-output">NP[]/VP[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'?x/?x'</span>)
<span class="pysrc-output">?x[]/?x[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(FeatStruct(<span class="pysrc-string">'VP[+fin, agr=?x, tense=past]/NP[+pl, agr=?x]'</span>))
<span class="pysrc-output">[ *type*  = 'VP'              ]</span>
<span class="pysrc-output">[                             ]</span>
<span class="pysrc-output">[           [ *type* = 'NP' ] ]</span>
<span class="pysrc-output">[ *slash* = [ agr    = ?x   ] ]</span>
<span class="pysrc-output">[           [ pl     = True ] ]</span>
<span class="pysrc-output">[                             ]</span>
<span class="pysrc-output">[ agr     = ?x                ]</span>
<span class="pysrc-output">[ fin     = True              ]</span>
<span class="pysrc-output">[ tense   = 'past'            ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<dl class="docutils">
<dt>Here the slash feature gets coerced:</dt>
<dd><div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[*slash*=a, x=b, *type*=&quot;NP&quot;]'</span>)
<span class="pysrc-output">NP[x='b']/a[]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'NP[sem=&lt;bob&gt;]/NP'</span>)
<span class="pysrc-output">NP[sem=&lt;bob&gt;]/NP[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'S[sem=&lt;walk(bob)&gt;]'</span>)
<span class="pysrc-output">S[sem=&lt;walk(bob)&gt;]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(FeatStruct(<span class="pysrc-string">'NP[sem=&lt;bob&gt;]/NP'</span>))
<span class="pysrc-output">[ *type*  = 'NP'              ]</span>
<span class="pysrc-output">[                             ]</span>
<span class="pysrc-output">[ *slash* = [ *type* = 'NP' ] ]</span>
<span class="pysrc-output">[                             ]</span>
<span class="pysrc-output">[ sem     = &lt;bob&gt;             ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</dd>
</dl>
<p>Playing with ranges:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> RangeFeature, FeatStructReader
<span class="pysrc-prompt">&gt;&gt;&gt; </span>width = RangeFeature(<span class="pysrc-string">'width'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>reader = FeatStructReader([width])
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = reader.fromstring(<span class="pysrc-string">'[*width*=-5:12]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = reader.fromstring(<span class="pysrc-string">'[*width*=2:123]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = reader.fromstring(<span class="pysrc-string">'[*width*=-7:-2]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[*width*=(2, 12)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs3)
<span class="pysrc-output">[*width*=(-5, -2)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs2.unify(fs3)) <span class="pysrc-comment"># no overlap in width.</span>
<span class="pysrc-output">None</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>The slash feature has a default value of 'False':</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(FeatStruct(<span class="pysrc-string">'NP[]/VP'</span>).unify(FeatStruct(<span class="pysrc-string">'NP[]'</span>), trace=1))
<span class="pysrc-output"></span>
<span class="pysrc-output">Unification trace:</span>
<span class="pysrc-output">   / NP[]/VP[]</span>
<span class="pysrc-output">  |\ NP[]</span>
<span class="pysrc-output">  |</span>
<span class="pysrc-output">  | Unify feature: *type*</span>
<span class="pysrc-output">  |    / 'NP'</span>
<span class="pysrc-output">  |   |\ 'NP'</span>
<span class="pysrc-output">  |   |</span>
<span class="pysrc-output">  |   +--&gt;'NP'</span>
<span class="pysrc-output">  |</span>
<span class="pysrc-output">  | Unify feature: *slash*</span>
<span class="pysrc-output">  |    / VP[]</span>
<span class="pysrc-output">  |   |\ False</span>
<span class="pysrc-output">  |   |</span>
<span class="pysrc-output">  X   X &lt;-- FAIL</span>
<span class="pysrc-output">None</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>The demo structures from category.py.  They all parse, but they don't
do quite the right thing, -- ?x vs x.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(pos=<span class="pysrc-string">'n'</span>, agr=FeatStruct(number=<span class="pysrc-string">'pl'</span>, gender=<span class="pysrc-string">'f'</span>))
<span class="pysrc-output">[agr=[gender='f', number='pl'], pos='n']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(r<span class="pysrc-string">'NP[sem=&lt;bob&gt;]/NP'</span>)
<span class="pysrc-output">NP[sem=&lt;bob&gt;]/NP[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(r<span class="pysrc-string">'S[sem=&lt;app(?x, ?y)&gt;]'</span>)
<span class="pysrc-output">S[sem=&lt;?x(?y)&gt;]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'?x/?x'</span>)
<span class="pysrc-output">?x[]/?x[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'VP[+fin, agr=?x, tense=past]/NP[+pl, agr=?x]'</span>)
<span class="pysrc-output">VP[agr=?x, +fin, tense='past']/NP[agr=?x, +pl]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'S[sem = &lt;app(?subj, ?vp)&gt;]'</span>)
<span class="pysrc-output">S[sem=&lt;?subj(?vp)&gt;]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'S'</span>)
<span class="pysrc-output">S[]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>The parser also includes support for reading sets and tuples.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x={1,2,2,2}, y={/}]'</span>)
<span class="pysrc-output">[x={1, 2}, y={/}]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x=(1,2,2,2), y=()]'</span>)
<span class="pysrc-output">[x=(1, 2, 2, 2), y=()]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(FeatStruct(<span class="pysrc-string">'[x=(1,[z=(1,2,?x)],?z,{/})]'</span>))
<span class="pysrc-output">[ x = (1, [ z = (1, 2, ?x) ], ?z, {/}) ]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Note that we can't put a featstruct inside a tuple, because doing so
would hash it, and it's not frozen yet:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(FeatStruct(<span class="pysrc-string">'[x={[]}]'</span>))
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">TypeError: FeatStructs must be frozen before they can be hashed.</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>There's a special syntax for taking the union of sets: &quot;{...+...}&quot;.
The elements should only be variables or sets.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x={?a+?b+{1,2,3}}]'</span>)
<span class="pysrc-output">[x={?a+?b+{1, 2, 3}}]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>There's a special syntax for taking the concatenation of tuples:
&quot;(...+...)&quot;.  The elements should only be variables or tuples.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x=(?a+?b+(1,2,3))]'</span>)
<span class="pysrc-output">[x=(?a+?b+(1, 2, 3))]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Parsing gives helpful messages if your string contains an error.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=, b=5]]'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    [a=, b=5]]</span>
<span class="pysrc-except">       ^ Expected value</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=12 22, b=33]'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    [a=12 22, b=33]</span>
<span class="pysrc-except">         ^ Expected comma</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=5] [b=6]'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    [a=5] [b=6]</span>
<span class="pysrc-except">          ^ Expected end of string</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">' *++*'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    *++*</span>
<span class="pysrc-except">    ^ Expected open bracket or identifier</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x-&gt;(1)]'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    [x-&gt;(1)]</span>
<span class="pysrc-except">        ^ Expected bound identifier</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[x-&gt;y]'</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">    [x-&gt;y]</span>
<span class="pysrc-except">        ^ Expected identifier</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">''</span>)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Error parsing feature structure</span>
<span class="pysrc-except">&lt;BLANKLINE&gt;</span>
<span class="pysrc-except">    ^ Expected open bracket or identifier</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
<div class="section" id="unification">
<h2>2.5&nbsp;&nbsp;&nbsp;Unification</h2>
<p>Very simple unifications give the expected results:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct().unify(FeatStruct())
<span class="pysrc-output">[]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(number=<span class="pysrc-string">'singular'</span>).unify(FeatStruct())
<span class="pysrc-output">[number='singular']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct().unify(FeatStruct(number=<span class="pysrc-string">'singular'</span>))
<span class="pysrc-output">[number='singular']</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(number=<span class="pysrc-string">'singular'</span>).unify(FeatStruct(person=3))
<span class="pysrc-output">[number='singular', person=3]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Merging nested structures:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[A=[B=b]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[A=[C=c]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[A=[B='b', C='c']]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.unify(fs1)
<span class="pysrc-output">[A=[B='b', C='c']]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>A basic case of reentrant unification</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs4 = FeatStruct(<span class="pysrc-string">'[A=(1)[B=b], E=[F-&gt;(1)]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs5 = FeatStruct(<span class="pysrc-string">&quot;[A=[C='c'], E=[F=[D='d']]]&quot;</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs4.unify(fs5)
<span class="pysrc-output">[A=(1)[B='b', C='c', D='d'], E=[F-&gt;(1)]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs5.unify(fs4)
<span class="pysrc-output">[A=(1)[B='b', C='c', D='d'], E=[F-&gt;(1)]]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>More than 2 paths to a value</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">&quot;[a=[],b=[],c=[],d=[]]&quot;</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=(1)[], b-&gt;(1), c-&gt;(1), d-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[a=(1)[], b-&gt;(1), c-&gt;(1), d-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>fs1[a] gets unified with itself</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[x=(1)[], y-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[x=(1)[], y-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[x=(1)[], y-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Bound variables should get forwarded appropriately</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[A=(1)[X=x], B-&gt;(1), C=?cvar, D=?dvar]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[A=(1)[Y=y], B=(2)[Z=z], C-&gt;(1), D-&gt;(2)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[A=(1)[X='x', Y='y', Z='z'], B-&gt;(1), C-&gt;(1), D-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.unify(fs1)
<span class="pysrc-output">[A=(1)[X='x', Y='y', Z='z'], B-&gt;(1), C-&gt;(1), D-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Cyclic structure created by unification.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[F=(1)[], G-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[F=[H=(2)[]], G-&gt;(2)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = fs1.unify(fs2)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3
<span class="pysrc-output">[F=(1)[H-&gt;(1)], G-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'G'</span>]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'G'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'G'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'F'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Cyclic structure created w/ variables.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[F=[H=?x]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[F=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = fs1.unify(fs2, rename_vars=False)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3
<span class="pysrc-output">[F=(1)[H-&gt;(1)]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'F'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'F'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3[<span class="pysrc-string">'F'</span>] <span class="pysrc-keyword">is</span> fs3[<span class="pysrc-string">'F'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>][<span class="pysrc-string">'H'</span>]
<span class="pysrc-output">True</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Unifying w/ a cyclic feature structure.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs4 = FeatStruct(<span class="pysrc-string">'[F=[H=[H=[H=(1)[]]]], K-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3.unify(fs4)
<span class="pysrc-output">[F=(1)[H-&gt;(1)], K-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs4.unify(fs3)
<span class="pysrc-output">[F=(1)[H-&gt;(1)], K-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Variable bindings should preserve reentrance.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">&quot;[a=?x]&quot;</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = fs1.unify(FeatStruct(<span class="pysrc-string">&quot;[a=[]]&quot;</span>), bindings)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2[<span class="pysrc-string">'a'</span>] <span class="pysrc-keyword">is</span> bindings[Variable(<span class="pysrc-string">'?x'</span>)]
<span class="pysrc-output">True</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.unify(FeatStruct(<span class="pysrc-string">&quot;[b=?x]&quot;</span>), bindings)
<span class="pysrc-output">[a=(1)[], b-&gt;(1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Aliased variable tests</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">&quot;[a=?x, b=?x]&quot;</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">&quot;[b=?y, c=?y]&quot;</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = fs1.unify(fs2, bindings)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3
<span class="pysrc-output">[a=?x, b=?x, c=?x]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings
<span class="pysrc-output">{Variable('?y'): Variable('?x')}</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3.unify(FeatStruct(<span class="pysrc-string">&quot;[a=1]&quot;</span>))
<span class="pysrc-output">[a=1, b=1, c=1]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>If we keep track of the bindings, then we can use the same variable
over multiple calls to unify.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = fs1.unify(FeatStruct(<span class="pysrc-string">'[a=[]]'</span>), bindings)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.unify(FeatStruct(<span class="pysrc-string">'[b=?x]'</span>), bindings)
<span class="pysrc-output">[a=(1)[], b-&gt;(1)]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings
<span class="pysrc-output">{Variable('?x'): []}</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2, fs3, fs4, fs5 # clean-up -->
</div>
<div class="section" id="unification-bindings">
<h2>2.6&nbsp;&nbsp;&nbsp;Unification Bindings</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=12]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = FeatStruct(<span class="pysrc-string">'[b=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2, bindings)
<span class="pysrc-output">[a=12]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings
<span class="pysrc-output">{Variable('?x'): 12}</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3.substitute_bindings(bindings)
<span class="pysrc-output">[b=12]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 <span class="pysrc-comment"># substitute_bindings didn't mutate fs3.</span>
<span class="pysrc-output">[b=?x]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2.unify(fs3, bindings)
<span class="pysrc-output">[a=12, b=12]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x, b=1]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=5, b=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2, bindings)
<span class="pysrc-output">[a=5, b=1]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>sorted(bindings.items())
<span class="pysrc-output">[(Variable('?x'), 5), (Variable('?x2'), 1)]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2, fs3 # clean-up -->
</div>
<div class="section" id="expressions">
<h2>2.7&nbsp;&nbsp;&nbsp;Expressions</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>e = Expression.fromstring(<span class="pysrc-string">'\\P y.P(z,y)'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(x=e, y=Variable(<span class="pysrc-string">'z'</span>))
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(y=VariableExpression(Variable(<span class="pysrc-string">'John'</span>)))
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[x=&lt;\P y.P(John,y)&gt;, y=&lt;John&gt;]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
<div class="section" id="remove-variables">
<h2>2.8&nbsp;&nbsp;&nbsp;Remove Variables</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=?x, b=12, c=[d=?y]]'</span>).remove_variables()
<span class="pysrc-output">[b=12, c=[]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'(1)[a=[b=?x,c-&gt;(1)]]'</span>).remove_variables()
<span class="pysrc-output">(1)[a=[c-&gt;(1)]]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
<div class="section" id="equality-hashing">
<h2>2.9&nbsp;&nbsp;&nbsp;Equality &amp; Hashing</h2>
<p>The <cite>equal_values</cite> method checks whether two feature structures assign
the same value to every feature.  If the optional argument
<tt class="doctest"><span class="pre">check_reentrances</span></tt> is supplied, then it also returns false if there
is any difference in the reentrances.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>a = FeatStruct(<span class="pysrc-string">'(1)[x-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>b = FeatStruct(<span class="pysrc-string">'(1)[x-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>c = FeatStruct(<span class="pysrc-string">'(1)[x=[x-&gt;(1)]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>d = FeatStruct(<span class="pysrc-string">'[x=(1)[x-&gt;(1)]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>e = FeatStruct(<span class="pysrc-string">'(1)[x=[x-&gt;(1), y=1], y=1]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">def</span> <span class="pysrc-defname">compare</span>(x,y):
<span class="pysrc-more">... </span>    assert x.equal_values(y, True) == y.equal_values(x, True)
<span class="pysrc-more">... </span>    assert x.equal_values(y, False) == y.equal_values(x, False)
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">if</span> x.equal_values(y, True):
<span class="pysrc-more">... </span>        assert x.equal_values(y, False)
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'equal values, same reentrance'</span>)
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">elif</span> x.equal_values(y, False):
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'equal values, different reentrance'</span>)
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">else</span>:
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'different values'</span>)</pre>
</td>
</tr></table></td></tr>
</table></div>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(a, a)
<span class="pysrc-output">equal values, same reentrance</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(a, b)
<span class="pysrc-output">equal values, same reentrance</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(a, c)
<span class="pysrc-output">equal values, different reentrance</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(a, d)
<span class="pysrc-output">equal values, different reentrance</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(c, d)
<span class="pysrc-output">equal values, different reentrance</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(a, e)
<span class="pysrc-output">different values</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(c, e)
<span class="pysrc-output">different values</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(d, e)
<span class="pysrc-output">different values</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>compare(e, e)
<span class="pysrc-output">equal values, same reentrance</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature structures may not be hashed until they are frozen:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>hash(a)
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">TypeError: FeatStructs must be frozen before they can be hashed.</span>
<span class="pysrc-except"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>a.freeze()
<span class="pysrc-prompt">&gt;&gt;&gt; </span>v = hash(a)</pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Feature structures define hash consistently.  The following example
looks at the hash value for each (fs1,fs2) pair; if their hash values
are not equal, then they must not be equal.  If their hash values are
equal, then display a message, and indicate whether their values are
indeed equal.  Note that c and d currently have the same hash value,
even though they are not equal.  That is not a bug, strictly speaking,
but it wouldn't be a bad thing if it changed.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">for</span> fstruct <span class="pysrc-keyword">in</span> (a, b, c, d, e):
<span class="pysrc-more">... </span>    fstruct.freeze()
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">for</span> fs1_name <span class="pysrc-keyword">in</span> <span class="pysrc-string">'abcde'</span>:
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">for</span> fs2_name <span class="pysrc-keyword">in</span> <span class="pysrc-string">'abcde'</span>:
<span class="pysrc-more">... </span>        fs1 = locals()[fs1_name]
<span class="pysrc-more">... </span>        fs2 = locals()[fs2_name]
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">if</span> hash(fs1) != hash(fs2):
<span class="pysrc-more">... </span>            assert fs1 != fs2
<span class="pysrc-more">... </span>        <span class="pysrc-keyword">else</span>:
<span class="pysrc-more">... </span>            <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'%s and %s have the same hash value,'</span> %
<span class="pysrc-more">... </span>                   (fs1_name, fs2_name))
<span class="pysrc-more">... </span>            <span class="pysrc-keyword">if</span> fs1 == fs2: <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'and are equal'</span>)
<span class="pysrc-more">... </span>            <span class="pysrc-keyword">else</span>: <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'and are not equal'</span>)
<span class="pysrc-output">a and a have the same hash value, and are equal</span>
<span class="pysrc-output">a and b have the same hash value, and are equal</span>
<span class="pysrc-output">b and a have the same hash value, and are equal</span>
<span class="pysrc-output">b and b have the same hash value, and are equal</span>
<span class="pysrc-output">c and c have the same hash value, and are equal</span>
<span class="pysrc-output">c and d have the same hash value, and are not equal</span>
<span class="pysrc-output">d and c have the same hash value, and are not equal</span>
<span class="pysrc-output">d and d have the same hash value, and are equal</span>
<span class="pysrc-output">e and e have the same hash value, and are equal</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del a, b, c, d, e, v # clean-up -->
</div>
<div class="section" id="tracing">
<h2>2.10&nbsp;&nbsp;&nbsp;Tracing</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=[b=(1)[], c=?x], d-&gt;(1), e=[f=?x]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=(1)[c=&quot;C&quot;], e=[g-&gt;(1)]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2, trace=True)
<span class="pysrc-output"></span>
<span class="pysrc-output">Unification trace:</span>
<span class="pysrc-output">   / [a=[b=(1)[], c=?x], d-&gt;(1), e=[f=?x]]</span>
<span class="pysrc-output">  |\ [a=(1)[c='C'], e=[g-&gt;(1)]]</span>
<span class="pysrc-output">  |</span>
<span class="pysrc-output">  | Unify feature: a</span>
<span class="pysrc-output">  |    / [b=[], c=?x]</span>
<span class="pysrc-output">  |   |\ [c='C']</span>
<span class="pysrc-output">  |   |</span>
<span class="pysrc-output">  |   | Unify feature: a.c</span>
<span class="pysrc-output">  |   |    / ?x</span>
<span class="pysrc-output">  |   |   |\ 'C'</span>
<span class="pysrc-output">  |   |   |</span>
<span class="pysrc-output">  |   |   +--&gt;Variable('?x')</span>
<span class="pysrc-output">  |   |</span>
<span class="pysrc-output">  |   +--&gt;[b=[], c=?x]</span>
<span class="pysrc-output">  |       Bindings: {?x: 'C'}</span>
<span class="pysrc-output">  |</span>
<span class="pysrc-output">  | Unify feature: e</span>
<span class="pysrc-output">  |    / [f=?x]</span>
<span class="pysrc-output">  |   |\ [g=[c='C']]</span>
<span class="pysrc-output">  |   |</span>
<span class="pysrc-output">  |   +--&gt;[f=?x, g=[b=[], c=?x]]</span>
<span class="pysrc-output">  |       Bindings: {?x: 'C'}</span>
<span class="pysrc-output">  |</span>
<span class="pysrc-output">  +--&gt;[a=(1)[b=(2)[], c='C'], d-&gt;(2), e=[f='C', g-&gt;(1)]]</span>
<span class="pysrc-output">      Bindings: {?x: 'C'}</span>
<span class="pysrc-output">[a=(1)[b=(2)[], c='C'], d-&gt;(2), e=[f='C', g-&gt;(1)]]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt;</span>
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x, b=?z, c=?z]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=?y, b=?y, c=?q]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-comment">#fs1.unify(fs2, trace=True)</span>
<span class="pysrc-prompt">&gt;&gt;&gt;</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
<div class="section" id="unification-on-dicts-lists">
<h2>2.11&nbsp;&nbsp;&nbsp;Unification on Dicts &amp; Lists</h2>
<p>It's possible to do unification on dictionaries:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> unify
<span class="pysrc-prompt">&gt;&gt;&gt; </span>pprint(unify(dict(x=1, y=dict(z=2)), dict(x=1, q=5)), width=1)
<span class="pysrc-output">{'q': 5, 'x': 1, 'y': {'z': 2}}</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>It's possible to do unification on lists as well:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>unify([1, 2, 3], [1, Variable(<span class="pysrc-string">'x'</span>), 3])
<span class="pysrc-output">[1, 2, 3]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Mixing dicts and lists is fine:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>pprint(unify([dict(x=1, y=dict(z=2)),3], [dict(x=1, q=5),3]),
<span class="pysrc-more">... </span>              width=1)
<span class="pysrc-output">[{'q': 5, 'x': 1, 'y': {'z': 2}}, 3]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>Mixing dicts and FeatStructs is discouraged:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>unify(dict(x=1), FeatStruct(x=1))
<span class="pysrc-except">Traceback (most recent call last):</span>
<span class="pysrc-except">  . . .</span>
<span class="pysrc-except">ValueError: Mixing FeatStruct objects with Python dicts and lists is not supported.</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>But you can do it if you really want, by explicitly stating that both
dictionaries and FeatStructs should be treated as feature structures:</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>unify(dict(x=1), FeatStruct(x=1), fs_class=(dict, FeatStruct))
<span class="pysrc-output">{'x': 1}</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
<div class="section" id="finding-conflicts">
<h2>2.12&nbsp;&nbsp;&nbsp;Finding Conflicts</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> conflicts
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=[b=(1)[c=2], d-&gt;(1), e=[f-&gt;(1)]]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=[b=[c=[x=5]], d=[c=2], e=[f=[c=3]]]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">for</span> path <span class="pysrc-keyword">in</span> conflicts(fs1, fs2):
<span class="pysrc-more">... </span>    <span class="pysrc-keyword">print</span>(<span class="pysrc-string">'%-8s: %r vs %r'</span> % (<span class="pysrc-string">'.'</span>.join(path), fs1[path], fs2[path]))
<span class="pysrc-output">a.b.c   : 2 vs [x=5]</span>
<span class="pysrc-output">a.e.f.c : 2 vs 3</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
<div class="section" id="retracting-bindings">
<h2>2.13&nbsp;&nbsp;&nbsp;Retracting Bindings</h2>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">from</span> nltk.featstruct <span class="pysrc-keyword">import</span> retract_bindings
<span class="pysrc-prompt">&gt;&gt;&gt; </span>bindings = {}
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x, b=[c=?y]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=(1)[c=[d=1]], b-&gt;(1)]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs3 = fs1.unify(fs2, bindings)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs3)
<span class="pysrc-output">[ a = (1) [ c = [ d = 1 ] ] ]</span>
<span class="pysrc-output">[                           ]</span>
<span class="pysrc-output">[ b -&gt; (1)                  ]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>pprint(bindings)
<span class="pysrc-output">{Variable('?x'): [c=[d=1]], Variable('?y'): [d=1]}</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>retract_bindings(fs3, bindings)
<span class="pysrc-output">[a=?x, b=?x]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>pprint(bindings)
<span class="pysrc-output">{Variable('?x'): [c=?y], Variable('?y'): [d=1]}</span></pre>
</td>
</tr></table></td></tr>
</table></div>
</div>
</div>
<div class="section" id="squashed-bugs">
<h1>3&nbsp;&nbsp;&nbsp;Squashed Bugs</h1>
<p>In svn rev 5167, unifying two feature structures that used the same
variable would cause those variables to become aliased in the output.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[b=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[a=?x, b=?x2]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>There was a bug in svn revision 5172 that caused <cite>rename_variables</cite> to
rename variables to names that are already used.</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>FeatStruct(<span class="pysrc-string">'[a=?x, b=?x2]'</span>).rename_variables(
<span class="pysrc-more">... </span>    vars=[Variable(<span class="pysrc-string">'?x'</span>)])
<span class="pysrc-output">[a=?x3, b=?x2]</span>
<span class="pysrc-output"></span><span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=?x, b=?x2]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1.unify(fs2)
<span class="pysrc-output">[a=?x, b=?x2]</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<p>There was a bug in svn rev 5167 that caused us to get the following
example wrong.  Basically the problem was that we only followed
'forward' pointers for other, not self, when unifying two feature
structures.  (nb: this test assumes that features are unified in
alphabetical order -- if they are not, it might pass even if the bug
is present.)</p>
<div class="doctest">
<table border="0" cellpadding="0" cellspacing="0" class="doctest" width="95%">
<tr><td class="doctest">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td width="1" class="copybar"
        onclick="javascript:copy_doctest_to_clipboard(this.nextSibling);"
        >&nbsp;</td>
<td class="pysrc"><pre class="doctest">
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs1 = FeatStruct(<span class="pysrc-string">'[a=[x=1], b=?x, c=?x]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span>fs2 = FeatStruct(<span class="pysrc-string">'[a=(1)[], b-&gt;(1), c=[x=2]]'</span>)
<span class="pysrc-prompt">&gt;&gt;&gt; </span><span class="pysrc-keyword">print</span>(fs1.unify(fs2))
<span class="pysrc-output">None</span></pre>
</td>
</tr></table></td></tr>
</table></div>
<!-- >>> del fs1, fs2 # clean-up -->
</div>
</div>
</body>
</html>
