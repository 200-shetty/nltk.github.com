<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.11: http://docutils.sourceforge.net/" />
<title>Chat-80</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="chat-80">
<h1 class="title">Chat-80</h1>

<!-- Copyright (C) 2001-2013 NLTK Project -->
<!-- For license information, see LICENSE.TXT -->
<p>Chat-80 was a natural language system which allowed the user to
interrogate a Prolog knowledge base in the domain of world
geography. It was developed in the early '80s by Warren and Pereira; see
<a class="reference external" href="http://acl.ldc.upenn.edu/J/J82/J82-3002.pdf">http://acl.ldc.upenn.edu/J/J82/J82-3002.pdf</a> for a description and
<a class="reference external" href="http://www.cis.upenn.edu/~pereira/oldies.html">http://www.cis.upenn.edu/~pereira/oldies.html</a> for the source
files.</p>
<p>The <tt class="docutils literal">chat80</tt> module contains functions to extract data from the Chat-80
relation files ('the world database'), and convert then into a format
that can be incorporated in the FOL models of
<tt class="docutils literal">nltk.sem.evaluate</tt>. The code assumes that the Prolog
input files are available in the NLTK corpora directory.</p>
<p>The Chat-80 World Database consists of the following files:</p>
<pre class="literal-block">
world0.pl
rivers.pl
cities.pl
countries.pl
contain.pl
borders.pl
</pre>
<p>This module uses a slightly modified version of <tt class="docutils literal">world0.pl</tt>, in which
a set of Prolog rules have been omitted. The modified file is named
<tt class="docutils literal">world1.pl</tt>. Currently, the file <tt class="docutils literal">rivers.pl</tt> is not read in, since
it uses a list rather than a string in the second field.</p>
<div class="section" id="reading-chat-80-files">
<h1>Reading Chat-80 Files</h1>
<p>Chat-80 relations are like tables in a relational database. The
relation acts as the name of the table; the first argument acts as the
'primary key'; and subsequent arguments are further fields in the
table. In general, the name of the table provides a label for a unary
predicate whose extension is all the primary keys. For example,
relations in <tt class="docutils literal">cities.pl</tt> are of the following form:</p>
<pre class="literal-block">
'city(athens,greece,1368).'
</pre>
<p>Here, <tt class="docutils literal">'athens'</tt> is the key, and will be mapped to a member of the
unary predicate <em>city</em>.</p>
<p>By analogy with NLTK corpora, <tt class="docutils literal">chat80</tt> defines a number of 'items'
which correspond to the relations.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.sem import chat80
&gt;&gt;&gt; print(chat80.items) # doctest: +ELLIPSIS
('borders', 'circle_of_lat', 'circle_of_long', 'city', ...)
</pre>
</blockquote>
<p>The fields in the table are mapped to binary predicates. The first
argument of the predicate is the primary key, while the second
argument is the data in the relevant field. Thus, in the above
example, the third field is mapped to the binary predicate
<em>population_of</em>, whose extension is a set of pairs such as
<tt class="docutils literal">'(athens, 1368)'</tt>.</p>
<p>An exception to this general framework is required by the relations in
the files <tt class="docutils literal">borders.pl</tt> and <tt class="docutils literal">contains.pl</tt>. These contain facts of the
following form:</p>
<pre class="literal-block">
'borders(albania,greece).'

'contains0(africa,central_africa).'
</pre>
<p>We do not want to form a unary concept out the element in
the first field of these records, and we want the label of the binary
relation just to be <tt class="docutils literal">'border'</tt>/<tt class="docutils literal">'contain'</tt> respectively.</p>
<p>In order to drive the extraction process, we use 'relation metadata bundles'
which are Python dictionaries such as the following:</p>
<pre class="literal-block">
city = {'label': 'city',
        'closures': [],
        'schema': ['city', 'country', 'population'],
        'filename': 'cities.pl'}
</pre>
<p>According to this, the file <tt class="docutils literal"><span class="pre">city['filename']</span></tt> contains a list of
relational tuples (or more accurately, the corresponding strings in
Prolog form) whose predicate symbol is <tt class="docutils literal"><span class="pre">city['label']</span></tt> and whose
relational schema is <tt class="docutils literal"><span class="pre">city['schema']</span></tt>. The notion of a <tt class="docutils literal">closure</tt> is
discussed in the next section.</p>
</div>
<div class="section" id="concepts">
<h1>Concepts</h1>
<p>In order to encapsulate the results of the extraction, a class of
<tt class="docutils literal">Concept</tt>s is introduced.  A <tt class="docutils literal">Concept</tt> object has a number of
attributes, in particular a <tt class="docutils literal">prefLabel</tt>, an arity and <tt class="docutils literal">extension</tt>.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; c1 = chat80.Concept('dog', arity=1, extension=set(['d1', 'd2']))
&gt;&gt;&gt; print(c1)
Label = 'dog'
Arity = 1
Extension = ['d1', 'd2']
</pre>
</blockquote>
<p>The <tt class="docutils literal">extension</tt> attribute makes it easier to inspect the output of
the extraction.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; schema = ['city', 'country', 'population']
&gt;&gt;&gt; concepts = chat80.clause2concepts('cities.pl', 'city', schema)
&gt;&gt;&gt; concepts
[Concept('city'), Concept('country_of'), Concept('population_of')]
&gt;&gt;&gt; for c in concepts: # doctest: +NORMALIZE_WHITESPACE
...     print(&quot;%s:\n\t%s&quot; % (c.prefLabel, c.extension[:4]))
city:
    ['athens', 'bangkok', 'barcelona', 'berlin']
country_of:
    [('athens', 'greece'), ('bangkok', 'thailand'), ('barcelona', 'spain'), ('berlin', 'east_germany')]
population_of:
    [('athens', '1368'), ('bangkok', '1178'), ('barcelona', '1280'), ('berlin', '3481')]
</pre>
</blockquote>
<p>In addition, the <tt class="docutils literal">extension</tt> can be further
processed: in the case of the <tt class="docutils literal">'border'</tt> relation, we check that the
relation is <strong>symmetric</strong>, and in the case of the <tt class="docutils literal">'contain'</tt>
relation, we carry out the <strong>transitive closure</strong>. The closure
properties associated with a concept is indicated in the relation
metadata, as indicated earlier.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; borders = set([('a1', 'a2'), ('a2', 'a3')])
&gt;&gt;&gt; c2 = chat80.Concept('borders', arity=2, extension=borders)
&gt;&gt;&gt; print(c2)
Label = 'borders'
Arity = 2
Extension = [('a1', 'a2'), ('a2', 'a3')]
&gt;&gt;&gt; c3 = chat80.Concept('borders', arity=2, closures=['symmetric'], extension=borders)
&gt;&gt;&gt; c3.close()
&gt;&gt;&gt; print(c3)
Label = 'borders'
Arity = 2
Extension = [('a1', 'a2'), ('a2', 'a1'), ('a2', 'a3'), ('a3', 'a2')]
</pre>
</blockquote>
<p>The <tt class="docutils literal">extension</tt> of a <tt class="docutils literal">Concept</tt> object is then incorporated into a
<tt class="docutils literal">Valuation</tt> object.</p>
</div>
<div class="section" id="persistence">
<h1>Persistence</h1>
<p>The functions <tt class="docutils literal">val_dump</tt> and <tt class="docutils literal">val_load</tt> are provided to allow a
valuation to be stored in a persistent database and re-loaded, rather
than having to be re-computed each time.</p>
</div>
<div class="section" id="individuals-and-lexical-items">
<h1>Individuals and Lexical Items</h1>
<p>As well as deriving relations from the Chat-80 data, we also create a
set of individual constants, one for each entity in the domain. The
individual constants are string-identical to the entities. For
example, given a data item such as <tt class="docutils literal">'zloty'</tt>, we add to the valuation
a pair <tt class="docutils literal">('zloty', 'zloty')</tt>. In order to parse English sentences that
refer to these entities, we also create a lexical item such as the
following for each individual constant:</p>
<pre class="literal-block">
PropN[num=sg, sem=&lt;\P.(P zloty)&gt;] -&gt; 'Zloty'
</pre>
<p>The set of rules is written to the file <tt class="docutils literal">chat_pnames.fcfg</tt> in the
current directory.</p>
</div>
<div class="section" id="sql-query">
<h1>SQL Query</h1>
<p>The <tt class="docutils literal">city</tt> relation is also available in RDB form and can be queried
using SQL statements.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import nltk
&gt;&gt;&gt; q = &quot;SELECT City, Population FROM city_table WHERE Country = 'china' and Population &gt; 1000&quot;
&gt;&gt;&gt; for answer in chat80.sql_query('corpora/city_database/city.db', q):
...     print(&quot;%-10s %4s&quot; % answer)
canton     1496
chungking  1100
mukden     1551
peking     2031
shanghai   5407
tientsin   1795
</pre>
</blockquote>
<p>The (deliberately naive) grammar <tt class="docutils literal">sql.fcfg</tt> translates from English
to SQL:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; nltk.data.show_cfg('grammars/book_grammars/sql0.fcfg')
% start S
S[SEM=(?np + WHERE + ?vp)] -&gt; NP[SEM=?np] VP[SEM=?vp]
VP[SEM=(?v + ?pp)] -&gt; IV[SEM=?v] PP[SEM=?pp]
VP[SEM=(?v + ?ap)] -&gt; IV[SEM=?v] AP[SEM=?ap]
NP[SEM=(?det + ?n)] -&gt; Det[SEM=?det] N[SEM=?n]
PP[SEM=(?p + ?np)] -&gt; P[SEM=?p] NP[SEM=?np]
AP[SEM=?pp] -&gt; A[SEM=?a] PP[SEM=?pp]
NP[SEM='Country=&quot;greece&quot;'] -&gt; 'Greece'
NP[SEM='Country=&quot;china&quot;'] -&gt; 'China'
Det[SEM='SELECT'] -&gt; 'Which' | 'What'
N[SEM='City FROM city_table'] -&gt; 'cities'
IV[SEM=''] -&gt; 'are'
A -&gt; 'located'
P[SEM=''] -&gt; 'in'
</pre>
</blockquote>
<p>Given this grammar, we can express, and then execute, queries in English.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; cp = nltk.parse.load_parser('grammars/book_grammars/sql0.fcfg')
&gt;&gt;&gt; query = 'What cities are in China'
&gt;&gt;&gt; trees = cp.nbest_parse(query.split())
&gt;&gt;&gt; answer = trees[0].node['SEM']
&gt;&gt;&gt; q = &quot; &quot;.join(answer)
&gt;&gt;&gt; print(q)
SELECT City FROM city_table WHERE   Country=&quot;china&quot;
&gt;&gt;&gt; rows = chat80.sql_query('corpora/city_database/city.db', q)
&gt;&gt;&gt; for r in rows: print(&quot;%s&quot; % r, end=' ')
canton chungking dairen harbin kowloon mukden peking shanghai sian tientsin
</pre>
</blockquote>
<div class="section" id="using-valuations">
<h2>Using Valuations</h2>
<p>In order to convert such an extension into a valuation, we use the
<tt class="docutils literal">make_valuation()</tt> method; setting <tt class="docutils literal">read=True</tt> creates and returns
a new <tt class="docutils literal">Valuation</tt> object which contains the results.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; val = chat80.make_valuation(concepts, read=True)
&gt;&gt;&gt; 'calcutta' in val['city']
True
&gt;&gt;&gt; [town for (town, country) in val['country_of'] if country == 'india']
['bombay', 'calcutta', 'delhi', 'hyderabad', 'madras']
&gt;&gt;&gt; dom = val.domain
&gt;&gt;&gt; g = nltk.sem.Assignment(dom)
&gt;&gt;&gt; m = nltk.sem.Model(dom, val)
&gt;&gt;&gt; m.evaluate(r'population_of(jakarta, 533)', g)
True
</pre>
</blockquote>
</div>
</div>
</div>
</body>
</html>
