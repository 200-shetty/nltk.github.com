<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.11: http://docutils.sourceforge.net/" />
<title>Discourse Representation Theory</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="discourse-representation-theory">
<h1 class="title">Discourse Representation Theory</h1>

<!-- Copyright (C) 2001-2013 NLTK Project -->
<!-- For license information, see LICENSE.TXT -->
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.sem import logic
&gt;&gt;&gt; from nltk.inference import TableauProver
</pre>
</blockquote>
<div class="section" id="overview">
<h1>Overview</h1>
<p>A DRS can be created with the <tt class="docutils literal">DRS()</tt> constructor. This takes two arguments: a list of
discourse referents and list of conditions. .</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.sem.drt import *
&gt;&gt;&gt; dp = DrtParser()
&gt;&gt;&gt; man_x = dp.parse('man(x)')
&gt;&gt;&gt; walk_x = dp.parse('walk(x)')
&gt;&gt;&gt; x = dp.parse('x')
&gt;&gt;&gt; print(DRS([x], [man_x, walk_x]))
([x],[man(x), walk(x)])
</pre>
</blockquote>
<p>The <tt class="docutils literal">parse()</tt> method can also be applied directly to DRS
expressions, which allows them to be specified more
easily.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; drs1 = dp.parse('([x],[man(x),walk(x)])')
&gt;&gt;&gt; print(drs1)
([x],[man(x), walk(x)])
</pre>
</blockquote>
<p>DRSs can be <em>merged</em> using the <tt class="docutils literal">+</tt> operator.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; drs2 = dp.parse('([y],[woman(y),stop(y)])')
&gt;&gt;&gt; drs3 = drs1 + drs2
&gt;&gt;&gt; print(drs3)
(([x],[man(x), walk(x)]) + ([y],[woman(y), stop(y)]))
&gt;&gt;&gt; print(drs3.simplify())
([x,y],[man(x), walk(x), woman(y), stop(y)])
</pre>
</blockquote>
<p>We can embed DRSs as components of an <tt class="docutils literal">implies</tt> condition.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; s = '([], [(%s -&gt; %s)])' % (drs1, drs2)
&gt;&gt;&gt; print(dp.parse(s))
([],[(([x],[man(x), walk(x)]) -&gt; ([y],[woman(y), stop(y)]))])
</pre>
</blockquote>
<p>The <tt class="docutils literal">fol()</tt> method converts DRSs into FOL formulae.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x), walks(x)])').fol())
exists x.(man(x) &amp; walks(x))
&gt;&gt;&gt; print(dp.parse(r'([],[(([x],[man(x)]) -&gt; ([],[walks(x)]))])').fol())
all x.(man(x) -&gt; walks(x))
</pre>
</blockquote>
<p>In order to visualize a DRS, the <tt class="docutils literal">pprint()</tt> method can be use.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; drs3.pprint()
  _________     __________
 | x       |   | y        |
(|---------| + |----------|)
 | man(x)  |   | woman(y) |
 | walk(x) |   | stop(y)  |
 |_________|   |__________|
</pre>
</blockquote>
<div class="section" id="parse-to-semantics">
<h2>Parse to semantics</h2>
<!-- >>> logic._counter._value = 0 -->
<p>DRSs can be used for building compositional semantics in a feature
based grammar. To specify that we want to use DRSs, the appropriate
logic parser needs be passed as a parameter to <tt class="docutils literal">load_earley()</tt></p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.parse import load_parser
&gt;&gt;&gt; parser = load_parser('grammars/book_grammars/drt.fcfg', trace=0, logic_parser=DrtParser())
&gt;&gt;&gt; trees = parser.nbest_parse('a dog barks'.split())
&gt;&gt;&gt; print(trees[0].node['SEM'].simplify())
([x],[dog(x), bark(x)])
</pre>
</blockquote>
<p>Alternatively, a <tt class="docutils literal">FeatStructParser</tt> can be passed with the <tt class="docutils literal">logic_parser</tt> set on it</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.featstruct import FeatStructParser
&gt;&gt;&gt; from nltk.grammar import FeatStructNonterminal
&gt;&gt;&gt; parser = load_parser('grammars/book_grammars/drt.fcfg', trace=0, fstruct_parser=FeatStructParser(fdict_class=FeatStructNonterminal, logic_parser=DrtParser()))
&gt;&gt;&gt; trees = parser.nbest_parse('every girl chases a dog'.split())
&gt;&gt;&gt; print(trees[0].node['SEM'].simplify().normalize())
([],[(([z1],[girl(z1)]) -&gt; ([z2],[dog(z2), chase(z1,z2)]))])
</pre>
</blockquote>
</div>
</div>
<div class="section" id="unit-tests">
<h1>Unit Tests</h1>
<div class="section" id="parser">
<h2>Parser</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x,y],[sees(x,y)])'))
([x,y],[sees(x,y)])
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x), walks(x)])'))
([x],[man(x), walks(x)])
&gt;&gt;&gt; print(dp.parse(r'\x.([],[man(x), walks(x)])'))
\x.([],[man(x), walks(x)])
&gt;&gt;&gt; print(dp.parse(r'\x.\y.([],[sees(x,y)])'))
\x y.([],[sees(x,y)])
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x,y],[(x = y)])'))
([x,y],[(x = y)])
&gt;&gt;&gt; print(dp.parse(r'([x,y],[(x != y)])'))
([x,y],[-(x = y)])
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'\x.([],[walks(x)])(john)'))
(\x.([],[walks(x)]))(john)
&gt;&gt;&gt; print(dp.parse(r'\R.\x.([],[big(x,R)])(\y.([],[mouse(y)]))'))
(\R x.([],[big(x,R)]))(\y.([],[mouse(y)]))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'(([x],[walks(x)]) + ([y],[runs(y)]))'))
(([x],[walks(x)]) + ([y],[runs(y)]))
&gt;&gt;&gt; print(dp.parse(r'(([x,y],[walks(x), jumps(y)]) + (([z],[twos(z)]) + ([w],[runs(w)])))'))
(([x,y],[walks(x), jumps(y)]) + ([z],[twos(z)]) + ([w],[runs(w)]))
&gt;&gt;&gt; print(dp.parse(r'((([],[walks(x)]) + ([],[twos(x)])) + ([],[runs(x)]))'))
(([],[walks(x)]) + ([],[twos(x)]) + ([],[runs(x)]))
&gt;&gt;&gt; print(dp.parse(r'((([],[walks(x)]) + ([],[runs(x)])) + (([],[threes(x)]) + ([],[fours(x)])))'))
(([],[walks(x)]) + ([],[runs(x)]) + ([],[threes(x)]) + ([],[fours(x)]))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'(([],[walks(x)]) -&gt; ([],[runs(x)]))'))
(([],[walks(x)]) -&gt; ([],[runs(x)]))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[PRO(x), sees(John,x)])'))
([x],[PRO(x), sees(John,x)])
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x), -([],[walks(x)])])'))
([x],[man(x), -([],[walks(x)])])
&gt;&gt;&gt; print(dp.parse(r'([],[(([x],[man(x)]) -&gt; ([],[walks(x)]))])'))
([],[(([x],[man(x)]) -&gt; ([],[walks(x)]))])
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'DRS([x],[walk(x)])'))
([x],[walk(x)])
&gt;&gt;&gt; print(dp.parse(r'DRS([x][walk(x)])'))
([x],[walk(x)])
&gt;&gt;&gt; print(dp.parse(r'([x][walk(x)])'))
([x],[walk(x)])
</pre>
</blockquote>
</div>
<div class="section" id="simplify">
<h2><tt class="docutils literal">simplify()</tt></h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'\x.([],[man(x), walks(x)])(john)').simplify())
([],[man(john), walks(john)])
&gt;&gt;&gt; print(dp.parse(r'\x.\y.([z],[dog(z),sees(x,y)])(john)(mary)').simplify())
([z],[dog(z), sees(john,mary)])
&gt;&gt;&gt; print(dp.parse(r'\R x.([],[big(x,R)])(\y.([],[mouse(y)]))').simplify())
\x.([],[big(x,\y.([],[mouse(y)]))])
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'(([x],[walks(x)]) + ([y],[runs(y)]))').simplify())
([x,y],[walks(x), runs(y)])
&gt;&gt;&gt; print(dp.parse(r'(([x,y],[walks(x), jumps(y)]) + (([z],[twos(z)]) + ([w],[runs(w)])))').simplify())
([w,x,y,z],[walks(x), jumps(y), twos(z), runs(w)])
&gt;&gt;&gt; print(dp.parse(r'((([],[walks(x)]) + ([],[runs(x)]) + ([],[threes(x)]) + ([],[fours(x)])))').simplify())
([],[walks(x), runs(x), threes(x), fours(x)])
&gt;&gt;&gt; dp.parse(r'([x],[man(x)])+([x],[walks(x)])').simplify() == \
... dp.parse(r'([x,z1],[man(x), walks(z1)])')
True
&gt;&gt;&gt; dp.parse(r'([y],[boy(y), (([x],[dog(x)]) -&gt; ([],[chase(x,y)]))])+([x],[run(x)])').simplify() == \
... dp.parse(r'([y,z1],[boy(y), (([x],[dog(x)]) -&gt; ([],[chase(x,y)])), run(z1)])')
True
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r'\Q.(([x],[john(x),walks(x)]) + Q)(([x],[PRO(x),leaves(x)]))').simplify() == \
... dp.parse(r'([x,z1],[john(x), walks(x), PRO(z1), leaves(z1)])')
True
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; logic._counter._value = 0
&gt;&gt;&gt; print(dp.parse('([],[(([x],[dog(x)]) -&gt; ([e,y],[boy(y), chase(e), subj(e,x), obj(e,y)]))])+([e,x],[PRO(x), run(e), subj(e,x)])').simplify().normalize().normalize())
([e02,z5],[(([z3],[dog(z3)]) -&gt; ([e01,z4],[boy(z4), chase(e01), subj(e01,z3), obj(e01,z4)])), PRO(z5), run(e02), subj(e02,z5)])
</pre>
</blockquote>
</div>
<div class="section" id="fol">
<h2><tt class="docutils literal">fol()</tt></h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x,y],[sees(x,y)])').fol())
exists x y.sees(x,y)
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x), walks(x)])').fol())
exists x.(man(x) &amp; walks(x))
&gt;&gt;&gt; print(dp.parse(r'\x.([],[man(x), walks(x)])').fol())
\x.(man(x) &amp; walks(x))
&gt;&gt;&gt; print(dp.parse(r'\x y.([],[sees(x,y)])').fol())
\x y.sees(x,y)
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'\x.([],[walks(x)])(john)').fol())
\x.walks(x)(john)
&gt;&gt;&gt; print(dp.parse(r'\R x.([],[big(x,R)])(\y.([],[mouse(y)]))').fol())
(\R x.big(x,R))(\y.mouse(y))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'(([x],[walks(x)]) + ([y],[runs(y)]))').fol())
(exists x.walks(x) &amp; exists y.runs(y))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'(([],[walks(x)]) -&gt; ([],[runs(x)]))').fol())
(walks(x) -&gt; runs(x))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[PRO(x), sees(John,x)])').fol())
exists x.(PRO(x) &amp; sees(John,x))
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x), -([],[walks(x)])])').fol())
exists x.(man(x) &amp; -walks(x))
&gt;&gt;&gt; print(dp.parse(r'([],[(([x],[man(x)]) -&gt; ([],[walks(x)]))])').fol())
all x.(man(x) -&gt; walks(x))
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[man(x) | walks(x)])').fol())
exists x.(man(x) | walks(x))
&gt;&gt;&gt; print(dp.parse(r'P(x) + ([x],[walks(x)])').fol())
(P(x) &amp; exists x.walks(x))
</pre>
</blockquote>
</div>
<div class="section" id="resolve-anaphora">
<h2><tt class="docutils literal">resolve_anaphora()</tt></h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from nltk.sem.drt import AnaphoraResolutionException
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(resolve_anaphora(dp.parse(r'([x,y,z],[dog(x), cat(y), walks(z), PRO(z)])')))
([x,y,z],[dog(x), cat(y), walks(z), (z = [x,y])])
&gt;&gt;&gt; print(resolve_anaphora(dp.parse(r'([],[(([x],[dog(x)]) -&gt; ([y],[walks(y), PRO(y)]))])')))
([],[(([x],[dog(x)]) -&gt; ([y],[walks(y), (y = x)]))])
&gt;&gt;&gt; print(resolve_anaphora(dp.parse(r'(([x,y],[]) + ([],[PRO(x)]))')).simplify())
([x,y],[(x = y)])
&gt;&gt;&gt; try: print(resolve_anaphora(dp.parse(r'([x],[walks(x), PRO(x)])')))
... except AnaphoraResolutionException as e: print(e)
Variable 'x' does not resolve to anything.
&gt;&gt;&gt; print(resolve_anaphora(dp.parse('([e01,z6,z7],[boy(z6), PRO(z7), run(e01), subj(e01,z7)])')))
([e01,z6,z7],[boy(z6), (z7 = z6), run(e01), subj(e01,z7)])
</pre>
</blockquote>
</div>
<div class="section" id="equiv">
<h2><tt class="docutils literal">equiv()</tt>:</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; a = dp.parse(r'([x],[man(x), walks(x)])')
&gt;&gt;&gt; b = dp.parse(r'([x],[walks(x), man(x)])')
&gt;&gt;&gt; print(a.equiv(b, TableauProver()))
True
</pre>
</blockquote>
</div>
<div class="section" id="replace">
<h2><tt class="docutils literal">replace()</tt>:</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; a = dp.parse(r'a')
&gt;&gt;&gt; w = dp.parse(r'w')
&gt;&gt;&gt; x = dp.parse(r'x')
&gt;&gt;&gt; y = dp.parse(r'y')
&gt;&gt;&gt; z = dp.parse(r'z')
</pre>
</blockquote>
</div>
<div class="section" id="replace-bound">
<h2>replace bound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(x.variable, a, False))
([x],[give(x,y,z)])
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(x.variable, a, True))
([a],[give(a,y,z)])
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound">
<h2>replace unbound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, a, False))
([x],[give(x,a,z)])
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, a, True))
([x],[give(x,a,z)])
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound-with-bound">
<h2>replace unbound with bound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, x, False) == \
... dp.parse('([z1],[give(z1,x,z)])')
True
&gt;&gt;&gt; dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, x, True) == \
... dp.parse('([z1],[give(z1,x,z)])')
True
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound-with-unbound">
<h2>replace unbound with unbound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, z, False))
([x],[give(x,z,z)])
&gt;&gt;&gt; print(dp.parse(r'([x],[give(x,y,z)])').replace(y.variable, z, True))
([x],[give(x,z,z)])
</pre>
</blockquote>
</div>
<div class="section" id="id1">
<h2>replace unbound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(z.variable, a, False))
(([x],[P(x,y,a)]) + ([y],[Q(x,y,a)]))
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(z.variable, a, True))
(([x],[P(x,y,a)]) + ([y],[Q(x,y,a)]))
</pre>
</blockquote>
</div>
<div class="section" id="id2">
<h2>replace bound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(x.variable, a, False))
(([x],[P(x,y,z)]) + ([y],[Q(x,y,z)]))
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(x.variable, a, True))
(([a],[P(a,y,z)]) + ([y],[Q(a,y,z)]))
</pre>
</blockquote>
</div>
<div class="section" id="id3">
<h2>replace unbound with unbound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(z.variable, a, False))
(([x],[P(x,y,a)]) + ([y],[Q(x,y,a)]))
&gt;&gt;&gt; print(dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,z)])').replace(z.variable, a, True))
(([x],[P(x,y,a)]) + ([y],[Q(x,y,a)]))
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound-with-bound-on-same-side">
<h2>replace unbound with bound on same side</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,w)])').replace(z.variable, x, False) == \
... dp.parse(r'(([z1],[P(z1,y,x)]) + ([y],[Q(z1,y,w)]))')
True
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,w)])').replace(z.variable, x, True) == \
... dp.parse(r'(([z1],[P(z1,y,x)]) + ([y],[Q(z1,y,w)]))')
True
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound-with-bound-on-other-side">
<h2>replace unbound with bound on other side</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,w)])').replace(w.variable, x, False) == \
... dp.parse(r'(([z1],[P(z1,y,z)]) + ([y],[Q(z1,y,x)]))')
True
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([y],[Q(x,y,w)])').replace(w.variable, x, True) == \
... dp.parse(r'(([z1],[P(z1,y,z)]) + ([y],[Q(z1,y,x)]))')
True
</pre>
</blockquote>
</div>
<div class="section" id="replace-unbound-with-double-bound">
<h2>replace unbound with double bound</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([x],[Q(x,y,w)])').replace(z.variable, x, False) == \
... dp.parse(r'(([z1],[P(z1,y,x)]) + ([z1],[Q(z1,y,w)]))')
True
&gt;&gt;&gt; dp.parse(r'([x],[P(x,y,z)])+([x],[Q(x,y,w)])').replace(z.variable, x, True) == \
... dp.parse(r'(([z1],[P(z1,y,x)]) + ([z1],[Q(z1,y,w)]))')
True
</pre>
</blockquote>
</div>
<div class="section" id="regression-tests">
<h2>regression tests</h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; d = dp.parse('([x],[A(c), ([y],[B(x,y,z,a)])-&gt;([z],[C(x,y,z,a)])])')
&gt;&gt;&gt; print(d)
([x],[A(c), (([y],[B(x,y,z,a)]) -&gt; ([z],[C(x,y,z,a)]))])
&gt;&gt;&gt; d.pprint()
 ____________________________________
| x                                  |
|------------------------------------|
| A(c)                               |
|   ____________      ____________   |
|  | y          |    | z          |  |
| (|------------| -&gt; |------------|) |
|  | B(x,y,z,a) |    | C(x,y,z,a) |  |
|  |____________|    |____________|  |
|____________________________________|
&gt;&gt;&gt; print(str(d))
([x],[A(c), (([y],[B(x,y,z,a)]) -&gt; ([z],[C(x,y,z,a)]))])
&gt;&gt;&gt; print(d.fol())
exists x.(A(c) &amp; all y.(B(x,y,z,a) -&gt; exists z.C(x,y,z,a)))
&gt;&gt;&gt; print(d.replace(Variable('a'), DrtVariableExpression(Variable('r'))))
([x],[A(c), (([y],[B(x,y,z,r)]) -&gt; ([z],[C(x,y,z,r)]))])
&gt;&gt;&gt; print(d.replace(Variable('x'), DrtVariableExpression(Variable('r'))))
([x],[A(c), (([y],[B(x,y,z,a)]) -&gt; ([z],[C(x,y,z,a)]))])
&gt;&gt;&gt; print(d.replace(Variable('y'), DrtVariableExpression(Variable('r'))))
([x],[A(c), (([y],[B(x,y,z,a)]) -&gt; ([z],[C(x,y,z,a)]))])
&gt;&gt;&gt; print(d.replace(Variable('z'), DrtVariableExpression(Variable('r'))))
([x],[A(c), (([y],[B(x,y,r,a)]) -&gt; ([z],[C(x,y,z,a)]))])
&gt;&gt;&gt; print(d.replace(Variable('x'), DrtVariableExpression(Variable('r')), True))
([r],[A(c), (([y],[B(r,y,z,a)]) -&gt; ([z],[C(r,y,z,a)]))])
&gt;&gt;&gt; print(d.replace(Variable('y'), DrtVariableExpression(Variable('r')), True))
([x],[A(c), (([r],[B(x,r,z,a)]) -&gt; ([z],[C(x,r,z,a)]))])
&gt;&gt;&gt; print(d.replace(Variable('z'), DrtVariableExpression(Variable('r')), True))
([x],[A(c), (([y],[B(x,y,r,a)]) -&gt; ([r],[C(x,y,r,a)]))])
&gt;&gt;&gt; print(d == dp.parse('([l],[A(c), ([m],[B(l,m,z,a)])-&gt;([n],[C(l,m,n,a)])])'))
True
&gt;&gt;&gt; d = dp.parse('([],[([x,y],[B(x,y,h), ([a,b],[dee(x,a,g)])])-&gt;([z,w],[cee(x,y,f), ([c,d],[E(x,c,d,e)])])])')
&gt;&gt;&gt; sorted(d.free())
[Variable('B'), Variable('E'), Variable('e'), Variable('f'), Variable('g'), Variable('h')]
&gt;&gt;&gt; sorted(d.variables())
[Variable('B'), Variable('E'), Variable('e'), Variable('f'), Variable('g'), Variable('h')]
&gt;&gt;&gt; sorted(d.get_refs(True))
[Variable('a'), Variable('b'), Variable('c'), Variable('d'), Variable('w'), Variable('x'), Variable('y'), Variable('z')]
&gt;&gt;&gt; sorted(d.conds[0].get_refs(False))
[Variable('x'), Variable('y')]
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y), (x=y), ([],[B(x,y)])-&gt;([],[C(x,y)]), ([x,y],[D(x,y)])-&gt;([],[E(x,y)]), ([],[F(x,y)])-&gt;([x,y],[G(x,y)])])').eliminate_equality())
([x],[A(x,x), (([],[B(x,x)]) -&gt; ([],[C(x,x)])), (([x,y],[D(x,y)]) -&gt; ([],[E(x,y)])), (([],[F(x,x)]) -&gt; ([x,y],[G(x,y)]))])
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y), (x=y)]) -&gt; ([],[B(x,y)])').eliminate_equality())
(([x],[A(x,x)]) -&gt; ([],[B(x,x)]))
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y)]) -&gt; ([],[B(x,y), (x=y)])').eliminate_equality())
(([x,y],[A(x,y)]) -&gt; ([],[B(x,x)]))
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y), (x=y), ([],[B(x,y)])])').eliminate_equality())
([x],[A(x,x), ([],[B(x,x)])])
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y), ([],[B(x,y), (x=y)])])').eliminate_equality())
([x,y],[A(x,y), ([],[B(x,x)])])
&gt;&gt;&gt; print(dp.parse('([z8 z9 z10],[A(z8), z8=z10, z9=z10, B(z9), C(z10), D(z10)])').eliminate_equality())
([z9],[A(z9), B(z9), C(z9), D(z9)])
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y), (x=y), ([],[B(x,y)]), ([x,y],[C(x,y)])])').eliminate_equality())
([x],[A(x,x), ([],[B(x,x)]), ([x,y],[C(x,y)])])
&gt;&gt;&gt; print(dp.parse('([x,y],[A(x,y)]) + ([],[B(x,y), (x=y)]) + ([],[C(x,y)])').eliminate_equality())
([x],[A(x,x), B(x,x), C(x,x)])
&gt;&gt;&gt; print(dp.parse('([x,y],[B(x,y)])+([x,y],[C(x,y)])').replace(Variable('y'), DrtVariableExpression(Variable('x'))))
(([x,y],[B(x,y)]) + ([x,y],[C(x,y)]))
&gt;&gt;&gt; print(dp.parse('(([x,y],[B(x,y)])+([],[C(x,y)]))+([],[D(x,y)])').replace(Variable('y'), DrtVariableExpression(Variable('x'))))
(([x,y],[B(x,y)]) + ([],[C(x,y)]) + ([],[D(x,y)]))
&gt;&gt;&gt; print(dp.parse('(([],[B(x,y)])+([],[C(x,y)]))+([],[D(x,y)])').replace(Variable('y'), DrtVariableExpression(Variable('x'))))
(([],[B(x,x)]) + ([],[C(x,x)]) + ([],[D(x,x)]))
&gt;&gt;&gt; print(dp.parse('(([],[B(x,y), ([x,y],[A(x,y)])])+([],[C(x,y)]))+([],[D(x,y)])').replace(Variable('y'), DrtVariableExpression(Variable('x'))).normalize())
(([],[B(z3,z1), ([z2,z3],[A(z3,z2)])]) + ([],[C(z3,z1)]) + ([],[D(z3,z1)]))
</pre>
</blockquote>
</div>
</div>
<div class="section" id="parse-errors">
<h1>Parse errors</h1>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; def parse_error(drtstring):
...     try: dp.parse(drtstring)
...     except logic.ParseException as e: print(e)
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; parse_error(r'')
End of input found.  Expression expected.
&lt;BLANKLINE&gt;
^
&gt;&gt;&gt; parse_error(r'(')
End of input found.  Expression expected.
(
 ^
&gt;&gt;&gt; parse_error(r'()')
Unexpected token: ')'.  Expression expected.
()
 ^
&gt;&gt;&gt; parse_error(r'([')
End of input found.  Expected token ']'.
([
  ^
&gt;&gt;&gt; parse_error(r'([,')
',' is an illegal variable name.  Constants may not be quantified.
([,
  ^
&gt;&gt;&gt; parse_error(r'([x,')
End of input found.  Variable expected.
([x,
    ^
&gt;&gt;&gt; parse_error(r'([]')
End of input found.  Expected token '['.
([]
   ^
&gt;&gt;&gt; parse_error(r'([][')
End of input found.  Expected token ']'.
([][
    ^
&gt;&gt;&gt; parse_error(r'([][,')
Unexpected token: ','.  Expression expected.
([][,
    ^
&gt;&gt;&gt; parse_error(r'([][]')
End of input found.  Expected token ')'.
([][]
     ^
&gt;&gt;&gt; parse_error(r'([x][man(x)]) |')
End of input found.  Expression expected.
([x][man(x)]) |
               ^
</pre>
</blockquote>
</div>
<div class="section" id="pretty-printing">
<h1>Pretty Printing</h1>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r&quot;([],[])&quot;).pprint()
 __
|  |
|--|
|__|
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r&quot;([],[([x],[big(x), dog(x)]) -&gt; ([],[bark(x)]) -([x],[walk(x)])])&quot;).pprint()
 _____________________________
|                             |
|-----------------------------|
|   ________      _________   |
|  | x      |    |         |  |
| (|--------| -&gt; |---------|) |
|  | big(x) |    | bark(x) |  |
|  | dog(x) |    |_________|  |
|  |________|                 |
|      _________              |
|     | x       |             |
| __  |---------|             |
|   | | walk(x) |             |
|     |_________|             |
|_____________________________|
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r&quot;([x,y],[x=y]) + ([z],[dog(z), walk(z)])&quot;).pprint()
  _________     _________
 | x y     |   | z       |
(|---------| + |---------|)
 | (x = y) |   | dog(z)  |
 |_________|   | walk(z) |
               |_________|
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r&quot;([],[([x],[]) | ([y],[]) | ([z],[dog(z), walk(z)])])&quot;).pprint()
 _______________________________
|                               |
|-------------------------------|
|   ___     ___     _________   |
|  | x |   | y |   | z       |  |
| (|---| | |---| | |---------|) |
|  |___|   |___|   | dog(z)  |  |
|                  | walk(z) |  |
|                  |_________|  |
|_______________________________|
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; dp.parse(r&quot;\P.\Q.(([x],[]) + P(x) + Q(x))(\x.([],[dog(x)]))&quot;).pprint()
          ___                        ________
 \       | x |                 \    |        |
 /\ P Q.(|---| + P(x) + Q(x))( /\ x.|--------|)
         |___|                      | dog(x) |
                                    |________|
</pre>
</blockquote>
</div>
</div>
</body>
</html>
