<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>nltk.chunk.named_entity &mdash; NLTK 3.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="NLTK 3.0 documentation" href="../../../index.html" />
    <link rel="up" title="nltk.chunk" href="../chunk.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../../../index.html">NLTK 3.0 documentation</a></div>
        <div class="rel">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for nltk.chunk.named_entity</h1><div class="highlight"><pre>
<span class="c"># Natural Language Toolkit: Chunk parsing API</span>
<span class="c">#</span>
<span class="c"># Copyright (C) 2001-2015 NLTK Project</span>
<span class="c"># Author: Edward Loper &lt;edloper@gmail.com&gt;</span>
<span class="c"># URL: &lt;http://nltk.org/&gt;</span>
<span class="c"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Named entity chunker</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>

<span class="kn">from</span> <span class="nn">nltk.tag</span> <span class="kn">import</span> <span class="n">ClassifierBasedTagger</span><span class="p">,</span> <span class="n">pos_tag</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">nltk.classify</span> <span class="kn">import</span> <span class="n">MaxentClassifier</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">nltk.tree</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">nltk.data</span> <span class="kn">import</span> <span class="n">find</span>

<span class="kn">from</span> <span class="nn">nltk.chunk.api</span> <span class="kn">import</span> <span class="n">ChunkParserI</span>
<span class="kn">from</span> <span class="nn">nltk.chunk.util</span> <span class="kn">import</span> <span class="n">ChunkScore</span>

<div class="viewcode-block" id="NEChunkParserTagger"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.NEChunkParserTagger">[docs]</a><span class="k">class</span> <span class="nc">NEChunkParserTagger</span><span class="p">(</span><span class="n">ClassifierBasedTagger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The IOB tagger used by the chunk parser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="p">):</span>
        <span class="n">ClassifierBasedTagger</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
            <span class="n">classifier_builder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_classifier_builder</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_classifier_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MaxentClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">&#39;megam&#39;</span><span class="p">,</span>
                                           <span class="n">gaussian_prior_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="n">trace</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_english_wordlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_en_wordlist</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">words</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_en_wordlist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s">&#39;en-basic&#39;</span><span class="p">))</span>
            <span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_en_wordlist</span>
        <span class="k">return</span> <span class="n">wl</span>

    <span class="k">def</span> <span class="nf">_feature_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">history</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">simplify_pos</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prevword</span> <span class="o">=</span> <span class="n">prevprevword</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">prevpos</span> <span class="o">=</span> <span class="n">prevprevpos</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">prevshape</span> <span class="o">=</span> <span class="n">prevtag</span> <span class="o">=</span> <span class="n">prevprevtag</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prevword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">prevprevword</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">prevpos</span> <span class="o">=</span> <span class="n">simplify_pos</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">prevprevpos</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">prevtag</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prevshape</span> <span class="o">=</span> <span class="n">prevprevtag</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prevword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">prevprevword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">prevpos</span> <span class="o">=</span> <span class="n">simplify_pos</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">prevprevpos</span> <span class="o">=</span> <span class="n">simplify_pos</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">prevtag</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">prevprevtag</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">prevshape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">prevword</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">nextword</span> <span class="o">=</span> <span class="n">nextnextword</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">nextpos</span> <span class="o">=</span> <span class="n">nextnextpos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nextword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">nextpos</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">nextnextword</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">nextnextpos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nextword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">nextpos</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">nextnextword</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">nextnextpos</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c"># 89.6</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;bias&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">&#39;shape&#39;</span><span class="p">:</span> <span class="n">shape</span><span class="p">(</span><span class="n">word</span><span class="p">),</span>
            <span class="s">&#39;wordlen&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span>
            <span class="s">&#39;prefix3&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s">&#39;suffix3&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span>
            <span class="s">&#39;word&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span>
            <span class="s">&#39;en-wordlist&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_english_wordlist</span><span class="p">()),</span>
            <span class="s">&#39;prevtag&#39;</span><span class="p">:</span> <span class="n">prevtag</span><span class="p">,</span>
            <span class="s">&#39;prevpos&#39;</span><span class="p">:</span> <span class="n">prevpos</span><span class="p">,</span>
            <span class="s">&#39;nextpos&#39;</span><span class="p">:</span> <span class="n">nextpos</span><span class="p">,</span>
            <span class="s">&#39;prevword&#39;</span><span class="p">:</span> <span class="n">prevword</span><span class="p">,</span>
            <span class="s">&#39;nextword&#39;</span><span class="p">:</span> <span class="n">nextword</span><span class="p">,</span>
            <span class="s">&#39;word+nextpos&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">+</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">nextpos</span><span class="p">),</span>
            <span class="s">&#39;pos+prevtag&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">+</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">prevtag</span><span class="p">),</span>
            <span class="s">&#39;shape+prevtag&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">+</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prevshape</span><span class="p">,</span> <span class="n">prevtag</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">features</span>
</div>
<div class="viewcode-block" id="NEChunkParser"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.NEChunkParser">[docs]</a><span class="k">class</span> <span class="nc">NEChunkParser</span><span class="p">(</span><span class="n">ChunkParserI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expected input: list of pos-tagged words</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_train</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<div class="viewcode-block" id="NEChunkParser.parse"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.NEChunkParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Each token should be a pos-tagged word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tagged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tagger</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tagged_to_parse</span><span class="p">(</span><span class="n">tagged</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>
</div>
    <span class="k">def</span> <span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">):</span>
        <span class="c"># Convert to tagged sequence</span>
        <span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_to_tagged</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tagger</span> <span class="o">=</span> <span class="n">NEChunkParserTagger</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="n">corpus</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tagged_to_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagged_tokens</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a list of tagged tokens to a chunk-parse tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">tok</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tagged_tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;O&#39;</span><span class="p">:</span>
                <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;B-&#39;</span><span class="p">):</span>
                <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tree</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="p">[</span><span class="n">tok</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;I-&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sent</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tree</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">()</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
                    <span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tree</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="p">[</span><span class="n">tok</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">sent</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_to_tagged</span><span class="p">(</span><span class="n">sent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a chunk-parse tree to a list of tagged tokens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Warning -- empty chunk in sentence&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">toks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;B-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">label</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">child</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">toks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tok</span><span class="p">,</span> <span class="s">&#39;I-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">label</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">toks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">toks</span>
</div>
<div class="viewcode-block" id="shape"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.shape">[docs]</a><span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;[0-9]+(\.[0-9]*)?|[0-9]*\.[0-9]+$&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;number&#39;</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;\W+$&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;punct&#39;</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;\w+$&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&#39;upcase&#39;</span>
        <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&#39;downcase&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;mixedcase&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;other&#39;</span>
</div>
<div class="viewcode-block" id="simplify_pos"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.simplify_pos">[docs]</a><span class="k">def</span> <span class="nf">simplify_pos</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s">&quot;V&quot;</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="postag_tree"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.postag_tree">[docs]</a><span class="k">def</span> <span class="nf">postag_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="c"># Part-of-speech tagging.</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">()</span>
    <span class="n">tag_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
            <span class="n">newtree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tree</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">label</span><span class="p">(),</span> <span class="p">[]))</span>
            <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                <span class="n">newtree</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">subchild</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">tag_iter</span><span class="p">))</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newtree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">tag_iter</span><span class="p">))</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">newtree</span>
</div>
<div class="viewcode-block" id="load_ace_data"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.load_ace_data">[docs]</a><span class="k">def</span> <span class="nf">load_ace_data</span><span class="p">(</span><span class="n">roots</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;binary&#39;</span><span class="p">,</span> <span class="n">skip_bnews</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;bnews&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">skip_bnews</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.sgm&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">load_ace_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">fmt</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">sent</span>
</div>
<div class="viewcode-block" id="load_ace_file"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.load_ace_file">[docs]</a><span class="k">def</span> <span class="nf">load_ace_file</span><span class="p">(</span><span class="n">textfile</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;  - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">textfile</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">annfile</span> <span class="o">=</span> <span class="n">textfile</span><span class="o">+</span><span class="s">&#39;.tmx.rdc.xml&#39;</span>

    <span class="c"># Read the xml file, and get a list of entities</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">annfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;document/entity&#39;</span><span class="p">):</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;entity_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="k">for</span> <span class="n">mention</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;entity_mention&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mention</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="k">continue</span> <span class="c"># only NEs</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mention</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;head/charseq/start&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mention</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;head/charseq/end&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="p">)</span>

    <span class="c"># Read the text file, and mark the entities.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">textfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c"># Strip XML tags, since they don&#39;t count towards the indices</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&lt;(?!/?TEXT)[^&gt;]+&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c"># Blank out anything before/after &lt;TEXT&gt;</span>
    <span class="k">def</span> <span class="nf">subfunc</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;[\s\S]*&lt;TEXT&gt;&#39;</span><span class="p">,</span> <span class="n">subfunc</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&lt;/TEXT&gt;[\s\S]*&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c"># Simplify quotes</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;``&quot;</span><span class="p">,</span> <span class="s">&#39; &quot;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;&quot; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">entity_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">typ</span> <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">)</span>

    <span class="c"># Binary distinction (NE or not NE)</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;binary&#39;</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">i</span> <span class="c"># Overlapping!  Deal with this better?</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">toks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">s</span><span class="p">]))</span>
            <span class="n">toks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tree</span><span class="p">(</span><span class="s">&#39;NE&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">[</span><span class="n">s</span><span class="p">:</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">toks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:]))</span>
        <span class="k">yield</span> <span class="n">toks</span>

    <span class="c"># Multiclass distinction (NE type)</span>
    <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;multiclass&#39;</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">i</span> <span class="c"># Overlapping!  Deal with this better?</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">toks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">s</span><span class="p">]))</span>
            <span class="n">toks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tree</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">text</span><span class="p">[</span><span class="n">s</span><span class="p">:</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">toks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:]))</span>
        <span class="k">yield</span> <span class="n">toks</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;bad fmt value&#39;</span><span class="p">)</span>

<span class="c"># This probably belongs in a more general-purpose location (as does</span>
<span class="c"># the parse_to_tagged function).</span></div>
<div class="viewcode-block" id="cmp_chunks"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.cmp_chunks">[docs]</a><span class="k">def</span> <span class="nf">cmp_chunks</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">guessed</span><span class="p">):</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="n">NEChunkParser</span><span class="o">.</span><span class="n">_parse_to_tagged</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span>
    <span class="n">guessed</span> <span class="o">=</span> <span class="n">NEChunkParser</span><span class="o">.</span><span class="n">_parse_to_tagged</span><span class="p">(</span><span class="n">guessed</span><span class="p">)</span>
    <span class="n">ellipsis</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">ct</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">guessed</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ct</span> <span class="o">==</span> <span class="n">gt</span> <span class="o">==</span> <span class="s">&#39;O&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ellipsis</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;  </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;...&#39;</span><span class="p">,</span> <span class="s">&#39;...&#39;</span><span class="p">,</span> <span class="s">&#39;...&#39;</span><span class="p">))</span>
                <span class="n">ellipsis</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ellipsis</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%-15s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="build_model"><a class="viewcode-back" href="../../../api/nltk.chunk.html#nltk.chunk.named_entity.build_model">[docs]</a><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;binary&#39;</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Loading training data...&#39;</span><span class="p">)</span>
    <span class="n">train_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;corpora/ace_data/ace.dev&#39;</span><span class="p">),</span>
                   <span class="n">find</span><span class="p">(</span><span class="s">&#39;corpora/ace_data/ace.heldout&#39;</span><span class="p">),</span>
                   <span class="n">find</span><span class="p">(</span><span class="s">&#39;corpora/ace_data/bbn.dev&#39;</span><span class="p">),</span>
                   <span class="n">find</span><span class="p">(</span><span class="s">&#39;corpora/ace_data/muc.dev&#39;</span><span class="p">)]</span>
    <span class="n">train_trees</span> <span class="o">=</span> <span class="n">load_ace_data</span><span class="p">(</span><span class="n">train_paths</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">postag_tree</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">train_trees</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Training...&#39;</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">NEChunkParser</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">train_data</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Loading eval data...&#39;</span><span class="p">)</span>
    <span class="n">eval_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;corpora/ace_data/ace.eval&#39;</span><span class="p">)]</span>
    <span class="n">eval_trees</span> <span class="o">=</span> <span class="n">load_ace_data</span><span class="p">(</span><span class="n">eval_paths</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">eval_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">postag_tree</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">eval_trees</span><span class="p">]</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Evaluating...&#39;</span><span class="p">)</span>
    <span class="n">chunkscore</span> <span class="o">=</span> <span class="n">ChunkScore</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">correct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eval_data</span><span class="p">):</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">correct</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">chunkscore</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">cmp_chunks</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">chunkscore</span><span class="p">)</span>

    <span class="n">outfilename</span> <span class="o">=</span> <span class="s">&#39;/tmp/ne_chunker_</span><span class="si">%s</span><span class="s">.pickle&#39;</span> <span class="o">%</span> <span class="n">fmt</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving chunker to </span><span class="si">%s</span><span class="s">...&#39;</span> <span class="o">%</span> <span class="n">outfilename</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfilename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cp</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Make sure that the pickled object has the right class name:</span>
    <span class="kn">from</span> <span class="nn">nltk.chunk.named_entity</span> <span class="kn">import</span> <span class="n">build_model</span>

    <span class="n">build_model</span><span class="p">(</span><span class="s">&#39;binary&#39;</span><span class="p">)</span>
    <span class="n">build_model</span><span class="p">(</span><span class="s">&#39;multiclass&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">NLTK News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing NLTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Installing NLTK Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contribute to NLTK</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki/FAQ">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nltk/nltk/wiki">Wiki</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/nltk.html">API</a></li>
<li class="toctree-l1"><a class="reference external" href="http://www.nltk.org/howto">HOWTO</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2015, NLTK Project.
      Last updated on Feb 26, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>