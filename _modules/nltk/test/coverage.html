

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>nltk.test.coverage &mdash; NLTK 2.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="NLTK 2.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../../../index.html">NLTK 2.0 documentation</a></div>
        <div class="rel">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for nltk.test.coverage</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c">#</span>
<span class="c">#             Perforce Defect Tracking Integration Project</span>
<span class="c">#              &lt;http://www.ravenbrook.com/project/p4dti/&gt;</span>
<span class="c">#</span>
<span class="c">#                   COVERAGE.PY -- COVERAGE TESTING</span>
<span class="c">#</span>
<span class="c">#             Gareth Rees, Ravenbrook Limited, 2001-12-04</span>
<span class="c">#                     Ned Batchelder, 2004-12-12</span>
<span class="c">#         http://nedbatchelder.com/code/modules/coverage.html</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># 1. INTRODUCTION</span>
<span class="c">#</span>
<span class="c"># This module provides coverage testing for Python code.</span>
<span class="c">#</span>
<span class="c"># The intended readership is all Python developers.</span>
<span class="c">#</span>
<span class="c"># This document is not confidential.</span>
<span class="c">#</span>
<span class="c"># See [GDR 2001-12-04a] for the command-line interface, programmatic</span>
<span class="c"># interface and limitations.  See [GDR 2001-12-04b] for requirements and</span>
<span class="c"># design.</span>

<span class="sd">r&quot;&quot;&quot;Usage:</span>

<span class="sd">coverage.py -x [-p] MODULE.py [ARG1 ARG2 ...]</span>
<span class="sd">    Execute module, passing the given command-line arguments, collecting</span>
<span class="sd">    coverage data. With the -p option, write to a temporary file containing</span>
<span class="sd">    the machine name and process ID.</span>

<span class="sd">coverage.py -e</span>
<span class="sd">    Erase collected coverage data.</span>

<span class="sd">coverage.py -c</span>
<span class="sd">    Collect data from multiple coverage files (as created by -p option above)</span>
<span class="sd">    and store it into a single file representing the union of the coverage.</span>

<span class="sd">coverage.py -r [-m] [-o dir1,dir2,...] FILE1 FILE2 ...</span>
<span class="sd">    Report on the statement coverage for the given files.  With the -m</span>
<span class="sd">    option, show line numbers of the statements that weren&#39;t executed.</span>

<span class="sd">coverage.py -a [-d dir] [-o dir1,dir2,...] FILE1 FILE2 ...</span>
<span class="sd">    Make annotated copies of the given files, marking statements that</span>
<span class="sd">    are executed with &gt; and statements that are missed with !.  With</span>
<span class="sd">    the -d option, make the copies in that directory.  Without the -d</span>
<span class="sd">    option, make each copy in the same directory as the original.</span>

<span class="sd">-o dir,dir2,...</span>
<span class="sd">  Omit reporting or annotating files when their filename path starts with</span>
<span class="sd">  a directory listed in the omit list.</span>
<span class="sd">  e.g. python coverage.py -i -r -o c:\python23,lib\enthought\traits</span>

<span class="sd">Coverage data is saved in the file .coverage by default.  Set the</span>
<span class="sd">COVERAGE_FILE environment variable to save it somewhere else.&quot;&quot;&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&#39;plaintext en&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;2.77.20070729&quot;</span>    <span class="c"># see detailed history at the end of this file.</span>

<span class="kn">import</span> <span class="nn">compiler</span>
<span class="kn">import</span> <span class="nn">compiler.visitor</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">symbol</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">token</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gethostname</span>

<span class="c"># Python version compatibility</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">strclass</span> <span class="o">=</span> <span class="nb">basestring</span>   <span class="c"># new to 2.3</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">strclass</span> <span class="o">=</span> <span class="nb">str</span>

<span class="c"># 2. IMPLEMENTATION</span>
<span class="c">#</span>
<span class="c"># This uses the &quot;singleton&quot; pattern.</span>
<span class="c">#</span>
<span class="c"># The word &quot;morf&quot; means a module object (from which the source file can</span>
<span class="c"># be deduced by suitable manipulation of the __file__ attribute) or a</span>
<span class="c"># filename.</span>
<span class="c">#</span>
<span class="c"># When we generate a coverage report we have to canonicalize every</span>
<span class="c"># filename in the coverage dictionary just in case it refers to the</span>
<span class="c"># module we are reporting on.  It seems a shame to throw away this</span>
<span class="c"># information so the data in the coverage dictionary is transferred to</span>
<span class="c"># the &#39;cexecuted&#39; dictionary under the canonical filenames.</span>
<span class="c">#</span>
<span class="c"># The coverage dictionary is called &quot;c&quot; and the trace function &quot;t&quot;.  The</span>
<span class="c"># reason for these short names is that Python looks up variables by name</span>
<span class="c"># at runtime and so execution time depends on the length of variables!</span>
<span class="c"># In the bottleneck of this application it&#39;s appropriate to abbreviate</span>
<span class="c"># names to increase speed.</span>

<div class="viewcode-block" id="DefInfo"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.DefInfo">[docs]</a><span class="k">class</span> <span class="nc">DefInfo</span><span class="p">:</span>
    <span class="n">FUNC</span> <span class="o">=</span> <span class="s">&#39;func&#39;</span>
    <span class="n">CLASS</span> <span class="o">=</span> <span class="s">&#39;class&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">defstart</span><span class="p">,</span> <span class="n">codestart</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_for</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defstart</span> <span class="o">=</span> <span class="n">defstart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codestart</span> <span class="o">=</span> <span class="n">codestart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coverage</span> <span class="o">=</span> <span class="n">coverage</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;DefInfo(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codestart</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverage</span><span class="p">))</span>
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DefInfo.type_for"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.DefInfo.type_for">[docs]</a>    <span class="k">def</span> <span class="nf">type_for</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">compiler</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DefInfo</span><span class="o">.</span><span class="n">FUNC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DefInfo</span><span class="o">.</span><span class="n">CLASS</span>
</div></div>
<div class="viewcode-block" id="StatementFindingAstVisitor"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor">[docs]</a><span class="k">class</span> <span class="nc">StatementFindingAstVisitor</span><span class="p">(</span><span class="n">compiler</span><span class="o">.</span><span class="n">visitor</span><span class="o">.</span><span class="n">ASTVisitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A visitor for a parsed Abstract Syntax Tree which finds executable</span>
<span class="sd">        statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">suite_spots</span><span class="p">,</span> <span class="n">definfo</span><span class="p">):</span>
        <span class="n">compiler</span><span class="o">.</span><span class="n">visitor</span><span class="o">.</span><span class="n">ASTVisitor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements</span> <span class="o">=</span> <span class="n">statements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded</span> <span class="o">=</span> <span class="n">excluded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span> <span class="o">=</span> <span class="n">suite_spots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluding_suite</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span> <span class="o">=</span> <span class="n">definfo</span>
        
<div class="viewcode-block" id="StatementFindingAstVisitor.doRecursive"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doRecursive">[docs]</a>    <span class="k">def</span> <span class="nf">doRecursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">getChildNodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</div>
    <span class="n">visitStmt</span> <span class="o">=</span> <span class="n">visitModule</span> <span class="o">=</span> <span class="n">doRecursive</span>
    
<div class="viewcode-block" id="StatementFindingAstVisitor.doCode"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doCode">[docs]</a>    <span class="k">def</span> <span class="nf">doCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">&#39;decorators&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">decorators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">decorators</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recordAndDispatch</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="n">defstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">codestart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLastLine</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DefInfo</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">defstart</span><span class="p">,</span> <span class="n">codestart</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="c"># When we exit a block, build up dotted names.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">defstart</span> <span class="o">&lt;</span> <span class="n">defstart</span><span class="p">:</span> <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c"># When we exit a func block, hide any contained objects.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="n">DefInfo</span><span class="o">.</span><span class="n">FUNC</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">definfo</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
    <span class="n">visitFunction</span> <span class="o">=</span> <span class="n">visitClass</span> <span class="o">=</span> <span class="n">doCode</span>

<div class="viewcode-block" id="StatementFindingAstVisitor.getFirstLine"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.getFirstLine">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># Find the first line in the tree node.</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">getChildNodes</span><span class="p">():</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lineno</span> <span class="ow">and</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span> <span class="ow">or</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">lineno</span>
</div>
<div class="viewcode-block" id="StatementFindingAstVisitor.getLastLine"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.getLastLine">[docs]</a>    <span class="k">def</span> <span class="nf">getLastLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># Find the first line in the tree node.</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">getChildNodes</span><span class="p">():</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLastLine</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lineno</span>
    </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.doStatement"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doStatement">[docs]</a>    <span class="k">def</span> <span class="nf">doStatement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recordLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
</div>
    <span class="n">visitAssert</span> <span class="o">=</span> <span class="n">visitAssign</span> <span class="o">=</span> <span class="n">visitAssTuple</span> <span class="o">=</span> <span class="n">visitPrint</span> <span class="o">=</span> \
        <span class="n">visitPrintnl</span> <span class="o">=</span> <span class="n">visitRaise</span> <span class="o">=</span> <span class="n">visitSubscript</span> <span class="o">=</span> <span class="n">visitDecorators</span> <span class="o">=</span> \
        <span class="n">doStatement</span>
    
<div class="viewcode-block" id="StatementFindingAstVisitor.visitPass"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitPass">[docs]</a>    <span class="k">def</span> <span class="nf">visitPass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># Pass statements have weird interactions with docstrings.  If this</span>
        <span class="c"># pass statement is part of one of those pairs, claim that the statement</span>
        <span class="c"># is on the later of the two lines.</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
        </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitDiscard"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitDiscard">[docs]</a>    <span class="k">def</span> <span class="nf">visitDiscard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># Discard nodes are statements that execute an expression, but then</span>
        <span class="c"># discard the results.  This includes function calls, so we can&#39;t </span>
        <span class="c"># ignore them all.  But if the expression is a constant, the statement</span>
        <span class="c"># won&#39;t be &quot;executed&quot;, so don&#39;t count it now.</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s">&#39;Const&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doStatement</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StatementFindingAstVisitor.recordNodeLine"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.recordNodeLine">[docs]</a>    <span class="k">def</span> <span class="nf">recordNodeLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># Stmt nodes often have None, but shouldn&#39;t claim the first line of</span>
        <span class="c"># their children (because the first child might be an ignorable line</span>
        <span class="c"># like &quot;global a&quot;).</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s">&#39;Stmt&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recordLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
    </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.recordLine"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.recordLine">[docs]</a>    <span class="k">def</span> <span class="nf">recordLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="c"># Returns a bool, whether the line is included or excluded.</span>
        <span class="k">if</span> <span class="n">lineno</span><span class="p">:</span>
            <span class="c"># Multi-line tests introducing suites have to get charged to their</span>
            <span class="c"># keyword.</span>
            <span class="k">if</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="p">[</span><span class="n">lineno</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># If we&#39;re inside an excluded suite, record that this line was</span>
            <span class="c"># excluded.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluding_suite</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">excluded</span><span class="p">[</span><span class="n">lineno</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="c"># If this line is excluded, or suite_spots maps this line to</span>
            <span class="c"># another line that is exlcuded, then we&#39;re excluded.</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span> <span class="ow">or</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span> <span class="ow">and</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="p">[</span><span class="n">lineno</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="c"># Otherwise, this is an executable line.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">[</span><span class="n">lineno</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>
    </div>
    <span class="n">default</span> <span class="o">=</span> <span class="n">recordNodeLine</span>
    
<div class="viewcode-block" id="StatementFindingAstVisitor.recordAndDispatch"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.recordAndDispatch">[docs]</a>    <span class="k">def</span> <span class="nf">recordAndDispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recordNodeLine</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StatementFindingAstVisitor.doSuite"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doSuite">[docs]</a>    <span class="k">def</span> <span class="nf">doSuite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intro</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">exsuite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluding_suite</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">or</span> <span class="p">(</span><span class="n">intro</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recordNodeLine</span><span class="p">(</span><span class="n">intro</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluding_suite</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recordAndDispatch</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluding_suite</span> <span class="o">=</span> <span class="n">exsuite</span>
        </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.doPlainWordSuite"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doPlainWordSuite">[docs]</a>    <span class="k">def</span> <span class="nf">doPlainWordSuite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prevsuite</span><span class="p">,</span> <span class="n">suite</span><span class="p">):</span>
        <span class="c"># Finding the exclude lines for else&#39;s is tricky, because they aren&#39;t</span>
        <span class="c"># present in the compiler parse tree.  Look at the previous suite,</span>
        <span class="c"># and find its last line.  If any line between there and the else&#39;s</span>
        <span class="c"># first line are excluded, then we exclude the else.</span>
        <span class="n">lastprev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLastLine</span><span class="p">(</span><span class="n">prevsuite</span><span class="p">)</span>
        <span class="n">firstelse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstLine</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lastprev</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">firstelse</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suite_spots</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">suite</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">suite</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.doElse"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.doElse">[docs]</a>    <span class="k">def</span> <span class="nf">doElse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prevsuite</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">else_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doPlainWordSuite</span><span class="p">(</span><span class="n">prevsuite</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">else_</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitFor"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitFor">[docs]</a>    <span class="k">def</span> <span class="nf">visitFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doElse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</div>
    <span class="n">visitWhile</span> <span class="o">=</span> <span class="n">visitFor</span>

<div class="viewcode-block" id="StatementFindingAstVisitor.visitIf"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitIf">[docs]</a>    <span class="k">def</span> <span class="nf">visitIf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># The first test has to be handled separately from the rest.</span>
        <span class="c"># The first test is credited to the line with the &quot;if&quot;, but the others</span>
        <span class="c"># are credited to the line with the test for the elif.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">tests</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">tests</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doElse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">tests</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitTryExcept"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitTryExcept">[docs]</a>    <span class="k">def</span> <span class="nf">visitTryExcept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">handlers</span><span class="p">)):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
                <span class="c"># It&#39;s a plain &quot;except:&quot;.  Find the previous suite.</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doPlainWordSuite</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doElse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitTryFinally"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitTryFinally">[docs]</a>    <span class="k">def</span> <span class="nf">visitTryFinally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doPlainWordSuite</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitWith"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitWith">[docs]</a>    <span class="k">def</span> <span class="nf">visitWith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doSuite</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="StatementFindingAstVisitor.visitGlobal"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.StatementFindingAstVisitor.visitGlobal">[docs]</a>    <span class="k">def</span> <span class="nf">visitGlobal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c"># &quot;global&quot; statements don&#39;t execute like others (they don&#39;t call the</span>
        <span class="c"># trace function), so don&#39;t record their line numbers.</span>
        <span class="k">pass</span>
</div></div>
<span class="n">the_coverage</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CoverageException"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.CoverageException">[docs]</a><span class="k">class</span> <span class="nc">CoverageException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</div>
<div class="viewcode-block" id="coverage"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage">[docs]</a><span class="k">class</span> <span class="nc">coverage</span><span class="p">:</span>
    <span class="c"># Name of the cache file (unless environment variable is set).</span>
    <span class="n">cache_default</span> <span class="o">=</span> <span class="s">&quot;.coverage&quot;</span>

    <span class="c"># Environment variable naming the cache file.</span>
    <span class="n">cache_env</span> <span class="o">=</span> <span class="s">&quot;COVERAGE_FILE&quot;</span>

    <span class="c"># A dictionary with an entry for (Python source file name, line number</span>
    <span class="c"># in that file) if that line has been executed.</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c"># A map from canonical Python source file name to a dictionary in</span>
    <span class="c"># which there&#39;s an entry for each line number that has been</span>
    <span class="c"># executed.</span>
    <span class="n">cexecuted</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Cache of results of calling the analysis2() method, so that you can</span>
    <span class="c"># specify both -r and -a without doing double work.</span>
    <span class="n">analysis_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Cache of results of calling the canonical_filename() method, to</span>
    <span class="c"># avoid duplicating work.</span>
    <span class="n">canonical_filename_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">the_coverage</span>
        <span class="k">if</span> <span class="n">the_coverage</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoverageException</span><span class="p">,</span> <span class="s">&quot;Only one coverage object allowed.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usecache</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nesting</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cstack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s">&#39;# *pragma[: ]*[nN][oO] *[cC][oO][vV][eE][rR]&#39;</span><span class="p">)</span>

    <span class="c"># t(f, x, y).  This method is passed to sys.settrace as a trace function.  </span>
    <span class="c"># See [van Rossum 2001-07-20b, 9.2] for an explanation of sys.settrace and </span>
    <span class="c"># the arguments and return value of the trace function.</span>
    <span class="c"># See [van Rossum 2001-07-20a, 3.2] for a description of frame and code</span>
    <span class="c"># objects.</span>
    
<div class="viewcode-block" id="coverage.t"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.t">[docs]</a>    <span class="k">def</span> <span class="nf">t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">unused</span><span class="p">):</span>                                   <span class="c">#pragma: no cover</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s">&#39;line&#39;</span><span class="p">:</span>
            <span class="c">#print &quot;Executing %s @ %d&quot; % (f.f_code.co_filename, f.f_lineno)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cstack</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
    </div>
<div class="viewcode-block" id="coverage.help"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>     <span class="c">#pragma: no cover</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">error</span>
            <span class="k">print</span>
        <span class="k">print</span> <span class="n">__doc__</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.command_line"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.command_line">[docs]</a>    <span class="k">def</span> <span class="nf">command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">help_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">getopt</span>
        <span class="n">help_fn</span> <span class="o">=</span> <span class="n">help_fn</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">optmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;-a&#39;</span><span class="p">:</span> <span class="s">&#39;annotate&#39;</span><span class="p">,</span>
            <span class="s">&#39;-c&#39;</span><span class="p">:</span> <span class="s">&#39;collect&#39;</span><span class="p">,</span>
            <span class="s">&#39;-d:&#39;</span><span class="p">:</span> <span class="s">&#39;directory=&#39;</span><span class="p">,</span>
            <span class="s">&#39;-e&#39;</span><span class="p">:</span> <span class="s">&#39;erase&#39;</span><span class="p">,</span>
            <span class="s">&#39;-h&#39;</span><span class="p">:</span> <span class="s">&#39;help&#39;</span><span class="p">,</span>
            <span class="s">&#39;-i&#39;</span><span class="p">:</span> <span class="s">&#39;ignore-errors&#39;</span><span class="p">,</span>
            <span class="s">&#39;-m&#39;</span><span class="p">:</span> <span class="s">&#39;show-missing&#39;</span><span class="p">,</span>
            <span class="s">&#39;-p&#39;</span><span class="p">:</span> <span class="s">&#39;parallel-mode&#39;</span><span class="p">,</span>
            <span class="s">&#39;-r&#39;</span><span class="p">:</span> <span class="s">&#39;report&#39;</span><span class="p">,</span>
            <span class="s">&#39;-x&#39;</span><span class="p">:</span> <span class="s">&#39;execute&#39;</span><span class="p">,</span>
            <span class="s">&#39;-o:&#39;</span><span class="p">:</span> <span class="s">&#39;omit=&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="n">short_opts</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">optmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">long_opts</span> <span class="o">=</span> <span class="n">optmap</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">short_opts</span><span class="p">,</span> <span class="n">long_opts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">optmap</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">optmap</span><span class="p">[</span><span class="n">o</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">optmap</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">o</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">):</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">optmap</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">long_opts</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">long_opts</span><span class="p">:</span>
                <span class="n">settings</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">+</span><span class="s">&#39;=&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>       <span class="c">#pragma: no cover</span>
                <span class="k">pass</span>    <span class="c"># Can&#39;t get here, because getopt won&#39;t return anything unknown.</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">):</span>
            <span class="n">help_fn</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;erase&#39;</span><span class="p">,</span> <span class="s">&#39;execute&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;annotate&#39;</span><span class="p">,</span> <span class="s">&#39;report&#39;</span><span class="p">,</span> <span class="s">&#39;collect&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="n">help_fn</span><span class="p">(</span><span class="s">&quot;You can&#39;t specify the &#39;</span><span class="si">%s</span><span class="s">&#39; and &#39;</span><span class="si">%s</span><span class="s">&#39; &quot;</span>
                              <span class="s">&quot;options at the same time.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

        <span class="n">args_needed</span> <span class="o">=</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;execute&#39;</span><span class="p">)</span>
                       <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;annotate&#39;</span><span class="p">)</span>
                       <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report&#39;</span><span class="p">))</span>
        <span class="n">action</span> <span class="o">=</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;erase&#39;</span><span class="p">)</span> 
                  <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;collect&#39;</span><span class="p">)</span>
                  <span class="ow">or</span> <span class="n">args_needed</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
            <span class="n">help_fn</span><span class="p">(</span><span class="s">&quot;You must specify at least one of -e, -x, -c, -r, or -a.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args_needed</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">help_fn</span><span class="p">(</span><span class="s">&quot;Unexpected arguments: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;parallel-mode&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_ready</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;erase&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;execute&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">help_fn</span><span class="p">(</span><span class="s">&quot;Nothing to do.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">args</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="kn">import</span> <span class="nn">__main__</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">execfile</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;collect&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        
        <span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ignore-errors&#39;</span><span class="p">)</span>
        <span class="n">show_missing</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;show-missing&#39;</span><span class="p">)</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;directory=&#39;</span><span class="p">)</span>

        <span class="n">omit</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;omit=&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">omit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">omit</span> <span class="o">=</span> <span class="n">omit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">omit</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">show_missing</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="o">=</span><span class="n">omit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;annotate&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="o">=</span><span class="n">omit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.use_cache"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.use_cache">[docs]</a>    <span class="k">def</span> <span class="nf">use_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usecache</span><span class="p">,</span> <span class="n">cache_file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usecache</span> <span class="o">=</span> <span class="n">usecache</span>
        <span class="k">if</span> <span class="n">cache_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_default</span> <span class="o">=</span> <span class="n">cache_file</span>
        </div>
<div class="viewcode-block" id="coverage.get_ready"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.get_ready">[docs]</a>    <span class="k">def</span> <span class="nf">get_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parallel_mode</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecache</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_default</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_mode</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">+=</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">gethostname</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_cache</span> <span class="o">=</span> <span class="p">{}</span>
        </div>
<div class="viewcode-block" id="coverage.start"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parallel_mode</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_ready</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>                               <span class="c">#pragma: no cover</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">threading</span><span class="p">,</span> <span class="s">&#39;settrace&#39;</span><span class="p">):</span>
                <span class="n">threading</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nesting</span> <span class="o">+=</span> <span class="mi">1</span>
        </div>
<div class="viewcode-block" id="coverage.stop"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nesting</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>                               <span class="c">#pragma: no cover</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">threading</span><span class="p">,</span> <span class="s">&#39;settrace&#39;</span><span class="p">):</span>
                <span class="n">threading</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.erase"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.erase">[docs]</a>    <span class="k">def</span> <span class="nf">erase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.exclude"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.exclude">[docs]</a>    <span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">re</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span> <span class="o">+=</span> <span class="s">&quot;|&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span> <span class="o">+=</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">re</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
</div>
<div class="viewcode-block" id="coverage.begin_recursive"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.begin_recursive">[docs]</a>    <span class="k">def</span> <span class="nf">begin_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="coverage.end_recursive"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.end_recursive">[docs]</a>    <span class="k">def</span> <span class="nf">end_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c"># save().  Save coverage data to the coverage cache.</span>
</div>
<div class="viewcode-block" id="coverage.save"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canonicalize_filenames</span><span class="p">()</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">marshal</span>
            <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c"># restore().  Restore coverage data from the coverage cache (if it exists).</span>
</div>
<div class="viewcode-block" id="coverage.restore"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecache</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.restore_file"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.restore_file">[docs]</a>    <span class="k">def</span> <span class="nf">restore_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">marshal</span>
            <span class="n">cexecuted</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cexecuted</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">DictType</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">cexecuted</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="c"># collect(). Collect data in multiple files produced by parallel mode</span>
</div>
<div class="viewcode-block" id="coverage.collect"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache_dir</span><span class="p">,</span> <span class="n">local</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cache_dir</span> <span class="ow">or</span> <span class="s">&#39;.&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">local</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">cexecuted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_file</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="n">cexecuted</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.merge_data"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.merge_data">[docs]</a>    <span class="k">def</span> <span class="nf">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_data</span> <span class="ow">in</span> <span class="n">new_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">merge_file_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">file_name</span><span class="p">],</span> <span class="n">file_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_data</span>
</div>
<div class="viewcode-block" id="coverage.merge_file_data"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.merge_file_data">[docs]</a>    <span class="k">def</span> <span class="nf">merge_file_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line_number</span> <span class="ow">in</span> <span class="n">new_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">line_number</span><span class="p">):</span>
                <span class="n">cache_data</span><span class="p">[</span><span class="n">line_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">line_number</span><span class="p">]</span>

    <span class="c"># canonical_filename(filename).  Return a canonical filename for the</span>
    <span class="c"># file (that is, an absolute path with no redundant components and</span>
    <span class="c"># normalized case).  See [GDR 2001-12-04b, 3.3].</span>
</div>
<div class="viewcode-block" id="coverage.canonical_filename"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.canonical_filename">[docs]</a>    <span class="k">def</span> <span class="nf">canonical_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical_filename_cache</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">g</span>
                        <span class="k">break</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canonical_filename_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical_filename_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>

    <span class="c"># canonicalize_filenames().  Copy results from &quot;c&quot; to &quot;cexecuted&quot;, </span>
    <span class="c"># canonicalizing filenames on the way.  Clear the &quot;c&quot; map.</span>
</div>
<div class="viewcode-block" id="coverage.canonicalize_filenames"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.canonicalize_filenames">[docs]</a>    <span class="k">def</span> <span class="nf">canonicalize_filenames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">:</span>
                <span class="c"># Can&#39;t do anything useful with exec&#39;d strings, so skip them.</span>
                <span class="k">continue</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">lineno</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># morf_filename(morf).  Return the filename for a module or file.</span>
</div>
<div class="viewcode-block" id="coverage.morf_filename"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.morf_filename">[docs]</a>    <span class="k">def</span> <span class="nf">morf_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morf</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">morf</span><span class="p">,</span> <span class="s">&#39;__file__&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CoverageException</span><span class="p">,</span> <span class="s">&quot;Module has no __file__ attribute.&quot;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">morf</span><span class="o">.</span><span class="n">__file__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">morf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical_filename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c"># analyze_morf(morf).  Analyze the module or filename passed as</span>
    <span class="c"># the argument.  If the source code can&#39;t be found, raise an error.</span>
    <span class="c"># Otherwise, return a tuple of (1) the canonical filename of the</span>
    <span class="c"># source code for the module, (2) a list of lines of statements</span>
    <span class="c"># in the source code, (3) a list of lines of excluded statements,</span>
    <span class="c"># and (4), a map of line numbers to multi-line line number ranges, for</span>
    <span class="c"># statements that cross lines.</span>
    </div>
<div class="viewcode-block" id="coverage.analyze_morf"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.analyze_morf">[docs]</a>    <span class="k">def</span> <span class="nf">analyze_morf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_morf</span><span class="p">(</span><span class="n">morf</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="coverage.analyze_morf2"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.analyze_morf2">[docs]</a>    <span class="k">def</span> <span class="nf">analyze_morf2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_cache</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">morf</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_cache</span><span class="p">[</span><span class="n">morf</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morf_filename</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.pyc&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">CoverageException</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;No source for compiled code &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span>
                                   <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s">&#39;.py&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoverageException</span><span class="p">,</span> <span class="s">&quot;File &#39;</span><span class="si">%s</span><span class="s">&#39; not Python source.&quot;</span> <span class="o">%</span> <span class="n">filename</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rU&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">excluded_lines</span><span class="p">,</span> <span class="n">line_map</span><span class="p">,</span> <span class="n">definfo</span> <span class="o">=</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">find_executable_statements2</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                                                <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude_re</span><span class="p">)</span>
        <span class="n">source</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">excluded_lines</span><span class="p">,</span> <span class="n">line_map</span><span class="p">,</span> <span class="n">definfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_cache</span><span class="p">[</span><span class="n">morf</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="coverage.first_line_of_tree"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.first_line_of_tree">[docs]</a>    <span class="k">def</span> <span class="nf">first_line_of_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="coverage.last_line_of_tree"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.last_line_of_tree">[docs]</a>    <span class="k">def</span> <span class="nf">last_line_of_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="coverage.find_docstring_pass_pair"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.find_docstring_pass_pair">[docs]</a>    <span class="k">def</span> <span class="nf">find_docstring_pass_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">spots</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_string_constant</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pass_stmt</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">first_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_line_of_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">last_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_line_of_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">record_multiline</span><span class="p">(</span><span class="n">spots</span><span class="p">,</span> <span class="n">first_line</span><span class="p">,</span> <span class="n">last_line</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="coverage.is_string_constant"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.is_string_constant">[docs]</a>    <span class="k">def</span> <span class="nf">is_string_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">stmt</span> <span class="ow">and</span> <span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">expr_stmt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        </div>
<div class="viewcode-block" id="coverage.is_pass_stmt"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.is_pass_stmt">[docs]</a>    <span class="k">def</span> <span class="nf">is_pass_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">stmt</span> <span class="ow">and</span> <span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">pass_stmt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="coverage.record_multiline"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.record_multiline">[docs]</a>    <span class="k">def</span> <span class="nf">record_multiline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spots</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">spots</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            </div>
<div class="viewcode-block" id="coverage.get_suite_spots"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.get_suite_spots">[docs]</a>    <span class="k">def</span> <span class="nf">get_suite_spots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">spots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Analyze a parse tree to find suite introducers which span a number</span>
<span class="sd">            of lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(()):</span>
                <span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">suite</span><span class="p">:</span>
                    <span class="c"># Found a suite, look back for the colon and keyword.</span>
                    <span class="n">lineno_colon</span> <span class="o">=</span> <span class="n">lineno_word</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">COLON</span><span class="p">:</span>
                            <span class="c"># Colons are never executed themselves: we want the</span>
                            <span class="c"># line number of the last token before the colon.</span>
                            <span class="n">lineno_colon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_line_of_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">NAME</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;elif&#39;</span><span class="p">:</span>
                                <span class="c"># Find the line number of the first non-terminal</span>
                                <span class="c"># after the keyword.</span>
                                <span class="n">t</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">while</span> <span class="n">t</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">ISNONTERMINAL</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                                    <span class="n">lineno_word</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lineno_word</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">except_clause</span><span class="p">:</span>
                            <span class="c"># &quot;except&quot; clauses look like:</span>
                            <span class="c"># (&#39;except_clause&#39;, (&#39;NAME&#39;, &#39;except&#39;, lineno), ...)</span>
                            <span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">NAME</span><span class="p">:</span>
                                <span class="n">lineno_word</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                                <span class="k">break</span>
                    <span class="k">if</span> <span class="n">lineno_colon</span> <span class="ow">and</span> <span class="n">lineno_word</span><span class="p">:</span>
                        <span class="c"># Found colon and keyword, mark all the lines</span>
                        <span class="c"># between the two with the two line numbers.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">record_multiline</span><span class="p">(</span><span class="n">spots</span><span class="p">,</span> <span class="n">lineno_word</span><span class="p">,</span> <span class="n">lineno_colon</span><span class="p">)</span>

                    <span class="c"># &quot;pass&quot; statements are tricky: different versions of Python</span>
                    <span class="c"># treat them differently, especially in the common case of a</span>
                    <span class="c"># function with a doc string and a single pass statement.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_docstring_pass_pair</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spots</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">simple_stmt</span><span class="p">:</span>
                    <span class="n">first_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_line_of_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">last_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_line_of_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">first_line</span> <span class="o">!=</span> <span class="n">last_line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">record_multiline</span><span class="p">(</span><span class="n">spots</span><span class="p">,</span> <span class="n">first_line</span><span class="p">,</span> <span class="n">last_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_suite_spots</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spots</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.find_executable_statements"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.find_executable_statements">[docs]</a>    <span class="k">def</span> <span class="nf">find_executable_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_executable_statements2</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="coverage.find_executable_statements2"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.find_executable_statements2">[docs]</a>    <span class="k">def</span> <span class="nf">find_executable_statements2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Find lines which match an exclusion pattern.</span>
        <span class="n">excluded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">suite_spots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">reExclude</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">reExclude</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">excluded</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># Parse the code and analyze the parse tree to find out which statements</span>
        <span class="c"># are multiline, and where suites begin and end.</span>
        <span class="kn">import</span> <span class="nn">parser</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">suite</span><span class="p">(</span><span class="n">text</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">totuple</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_suite_spots</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">suite_spots</span><span class="p">)</span>
        <span class="c">#print &quot;Suite spots:&quot;, suite_spots</span>

        <span class="c"># Mapping from name of func/class -&gt; (start, end).</span>
        <span class="n">definfo</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Use the compiler module to parse the text and find the executable</span>
        <span class="c"># statements.  We add newlines to be impervious to final partial lines.</span>
        <span class="n">statements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">visitor</span> <span class="o">=</span> <span class="n">StatementFindingAstVisitor</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span>
                                             <span class="n">suite_spots</span><span class="p">,</span> <span class="n">definfo</span><span class="p">)</span>
        <span class="n">compiler</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">visitor</span><span class="p">,</span> <span class="n">walker</span><span class="o">=</span><span class="n">visitor</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">statements</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">excluded_lines</span> <span class="o">=</span> <span class="n">excluded</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">excluded_lines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lines</span><span class="p">,</span> <span class="n">excluded_lines</span><span class="p">,</span> <span class="n">suite_spots</span><span class="p">,</span> <span class="n">definfo</span>

    <span class="c"># format_lines(statements, lines).  Format a list of line numbers</span>
    <span class="c"># for printing by coalescing groups of lines as long as the lines</span>
    <span class="c"># represent consecutive statements.  This will coalesce even if</span>
    <span class="c"># there are gaps between statements, so if statements =</span>
    <span class="c"># [1,2,3,4,5,10,11,12,13,14] and lines = [1,2,5,10,11,13,14] then</span>
    <span class="c"># format_lines will return &quot;1-2, 5-11, 13-14&quot;.</span>
</div>
<div class="viewcode-block" id="coverage.format_lines"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.format_lines">[docs]</a>    <span class="k">def</span> <span class="nf">format_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">statements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">start</span><span class="p">:</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
                <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">pair</span><span class="p">):</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">pair</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">start</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">stringify</span><span class="p">,</span> <span class="n">pairs</span><span class="p">),</span> <span class="s">&quot;, &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="c"># Backward compatibility with version 1.</span></div>
<div class="viewcode-block" id="coverage.analysis"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.analysis">[docs]</a>    <span class="k">def</span> <span class="nf">analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis2</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mf</span>
</div>
<div class="viewcode-block" id="coverage.analysis2"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.analysis2">[docs]</a>    <span class="k">def</span> <span class="nf">analysis2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis3</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mf</span>
    </div>
<div class="viewcode-block" id="coverage.analysis3"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.analysis3">[docs]</a>    <span class="k">def</span> <span class="nf">analysis3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">line_map</span><span class="p">,</span> <span class="n">definfo</span> <span class="o">=</span> \
                  <span class="bp">self</span><span class="o">.</span><span class="n">analyze_morf2</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canonicalize_filenames</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">line_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">line</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cexecuted</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_def_coverage</span><span class="p">(</span><span class="n">morf</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">definfo</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_lines</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">missing</span><span class="p">),</span> <span class="n">definfo</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.find_def_coverage"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.find_def_coverage">[docs]</a>    <span class="k">def</span> <span class="nf">find_def_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">definfo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return mapping from function name to coverage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">def_coverage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="n">statements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">definfo</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">codestart</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">info</span><span class="o">.</span><span class="n">coverage</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">codestart</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">statements</span><span class="p">))</span>
                <span class="n">miss</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">miss</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">cover</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">coverage</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">miss</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">stmt</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="coverage.relative_filename"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.relative_filename">[docs]</a>    <span class="k">def</span> <span class="nf">relative_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert filename to relative filename from self.relative_dir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relative_dir</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="coverage.morf_name"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.morf_name">[docs]</a>    <span class="k">def</span> <span class="nf">morf_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the name of morf as used in report.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morf</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">morf</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_filename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">morf</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="coverage.filter_by_prefix"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.filter_by_prefix">[docs]</a>    <span class="k">def</span> <span class="nf">filter_by_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morfs</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return list of morfs where the morf name does not begin</span>
<span class="sd">            with any one of the omit_prefixes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filtered_morfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">morf</span> <span class="ow">in</span> <span class="n">morfs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">omit_prefixes</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filtered_morfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_morfs</span>
</div>
<div class="viewcode-block" id="coverage.morf_name_compare"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.morf_name_compare">[docs]</a>    <span class="k">def</span> <span class="nf">morf_name_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="coverage.report"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morfs</span><span class="p">,</span> <span class="n">show_missing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morfs</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ListType</span><span class="p">):</span>
            <span class="n">morfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">morfs</span><span class="p">]</span>
        <span class="c"># On windows, the shell doesn&#39;t expand wildcards.  Do it here.</span>
        <span class="n">globbed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">morf</span> <span class="ow">in</span> <span class="n">morfs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morf</span><span class="p">,</span> <span class="n">strclass</span><span class="p">):</span>
                <span class="n">globbed</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">morf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">globbed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
        <span class="n">morfs</span> <span class="o">=</span> <span class="n">globbed</span>
        
        <span class="n">morfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_by_prefix</span><span class="p">(</span><span class="n">morfs</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="p">)</span>
        <span class="n">morfs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morf_name_compare</span><span class="p">)</span>

        <span class="n">max_name</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">5</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">,</span> <span class="n">morfs</span><span class="p">)))</span>
        <span class="n">fmt_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">- </span><span class="si">%d</span><span class="s">s  &quot;</span> <span class="o">%</span> <span class="n">max_name</span>
        <span class="n">fmt_err</span> <span class="o">=</span> <span class="n">fmt_name</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">fmt_name</span> <span class="o">%</span> <span class="s">&quot;Name&quot;</span> <span class="o">+</span> <span class="s">&quot; Stmts   Exec  Cover&quot;</span>
        <span class="n">fmt_coverage</span> <span class="o">=</span> <span class="n">fmt_name</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">% 6d</span><span class="s"> </span><span class="si">% 6d</span><span class="s"> </span><span class="si">% 5d%%</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="n">show_missing</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="s">&quot;   Missing&quot;</span>
            <span class="n">fmt_coverage</span> <span class="o">=</span> <span class="n">fmt_coverage</span> <span class="o">+</span> <span class="s">&quot;   </span><span class="si">%s</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">file</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="n">header</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="s">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">total_statements</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_executed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">morf</span> <span class="ow">in</span> <span class="n">morfs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morf_name</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">readable</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis2</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pc</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">m</span> <span class="o">/</span> <span class="n">n</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pc</span> <span class="o">=</span> <span class="mf">100.0</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">pc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_missing</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">readable</span><span class="p">,)</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="n">fmt_coverage</span> <span class="o">%</span> <span class="n">args</span>
                <span class="n">total_statements</span> <span class="o">=</span> <span class="n">total_statements</span> <span class="o">+</span> <span class="n">n</span>
                <span class="n">total_executed</span> <span class="o">=</span> <span class="n">total_executed</span> <span class="o">+</span> <span class="n">m</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>                       <span class="c">#pragma: no cover</span>
                <span class="k">raise</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                    <span class="n">typ</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="n">fmt_err</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">morfs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="s">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_statements</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">total_executed</span> <span class="o">/</span> <span class="n">total_statements</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="mf">100.0</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;TOTAL&quot;</span><span class="p">,</span> <span class="n">total_statements</span><span class="p">,</span> <span class="n">total_executed</span><span class="p">,</span> <span class="n">pc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_missing</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="nb">file</span><span class="p">,</span> <span class="n">fmt_coverage</span> <span class="o">%</span> <span class="n">args</span>

    <span class="c"># annotate(morfs, ignore_errors).</span>
</div>
    <span class="n">blank_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\s*(#|$)&quot;</span><span class="p">)</span>
    <span class="n">else_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\s*else\s*:\s*(#|$)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="coverage.annotate"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.annotate">[docs]</a>    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morfs</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">morfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_by_prefix</span><span class="p">(</span><span class="n">morfs</span><span class="p">,</span> <span class="n">omit_prefixes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">morf</span> <span class="ow">in</span> <span class="n">morfs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis2</span><span class="p">(</span><span class="n">morf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotate_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                    <span class="k">raise</span>
                </div>
<div class="viewcode-block" id="coverage.annotate_file"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.coverage.annotate_file">[docs]</a>    <span class="k">def</span> <span class="nf">annotate_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">excluded</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rU&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
            <span class="n">dest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span>
                                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                                     <span class="o">+</span> <span class="s">&#39;,cover&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dest_file</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;,cover&#39;</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">covered</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span> <span class="ow">and</span> <span class="n">statements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lineno</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span> <span class="ow">and</span> <span class="n">missing</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lineno</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span> <span class="ow">and</span> <span class="n">statements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">lineno</span><span class="p">:</span>
                <span class="n">covered</span> <span class="o">=</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span> <span class="ow">or</span> <span class="n">missing</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lineno</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blank_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">else_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="c"># Special logic for lines containing only &#39;else:&#39;.  </span>
                <span class="c"># See [GDR 2001-12-04b, 3.2].</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;! &#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt; &#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">statements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">missing</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;! &#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt; &#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="n">excluded</span><span class="p">:</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;- &#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">covered</span><span class="p">:</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt; &#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;! &#39;</span><span class="p">)</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">source</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Singleton object.</span></div></div>
<span class="n">the_coverage</span> <span class="o">=</span> <span class="n">coverage</span><span class="p">()</span>

<span class="c"># Module functions call methods in the singleton object.</span>
<div class="viewcode-block" id="use_cache"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.use_cache">[docs]</a><span class="k">def</span> <span class="nf">use_cache</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">use_cache</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="start"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.start">[docs]</a><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="stop"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.stop">[docs]</a><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="erase"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.erase">[docs]</a><span class="k">def</span> <span class="nf">erase</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="begin_recursive"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.begin_recursive">[docs]</a><span class="k">def</span> <span class="nf">begin_recursive</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">begin_recursive</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="end_recursive"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.end_recursive">[docs]</a><span class="k">def</span> <span class="nf">end_recursive</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">end_recursive</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="exclude"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.exclude">[docs]</a><span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="analysis"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.analysis">[docs]</a><span class="k">def</span> <span class="nf">analysis</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">analysis</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="analysis2"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.analysis2">[docs]</a><span class="k">def</span> <span class="nf">analysis2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">analysis2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="analysis3"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.analysis3">[docs]</a><span class="k">def</span> <span class="nf">analysis3</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">analysis3</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="report"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.report">[docs]</a><span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="annotate"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.annotate">[docs]</a><span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="annotate_file"><a class="viewcode-back" href="../../../api/nltk.test.html#nltk.test.coverage.annotate_file">[docs]</a><span class="k">def</span> <span class="nf">annotate_file</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">annotate_file</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c"># Save coverage data when Python exits.  (The atexit module wasn&#39;t</span>
<span class="c"># introduced until Python 2.0, so use sys.exitfunc when it&#39;s not</span>
<span class="c"># available.)</span></div>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">atexit</span>
    <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">the_coverage</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exitfunc</span> <span class="o">=</span> <span class="n">the_coverage</span><span class="o">.</span><span class="n">save</span>

<span class="c"># Command-line interface.</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">the_coverage</span><span class="o">.</span><span class="n">command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>


<span class="c"># A. REFERENCES</span>
<span class="c">#</span>
<span class="c"># [GDR 2001-12-04a] &quot;Statement coverage for Python&quot;; Gareth Rees;</span>
<span class="c"># Ravenbrook Limited; 2001-12-04;</span>
<span class="c"># &lt;http://www.nedbatchelder.com/code/modules/rees-coverage.html&gt;.</span>
<span class="c">#</span>
<span class="c"># [GDR 2001-12-04b] &quot;Statement coverage for Python: design and</span>
<span class="c"># analysis&quot;; Gareth Rees; Ravenbrook Limited; 2001-12-04;</span>
<span class="c"># &lt;http://www.nedbatchelder.com/code/modules/rees-design.html&gt;.</span>
<span class="c">#</span>
<span class="c"># [van Rossum 2001-07-20a] &quot;Python Reference Manual (releae 2.1.1)&quot;;</span>
<span class="c"># Guide van Rossum; 2001-07-20;</span>
<span class="c"># &lt;http://www.python.org/doc/2.1.1/ref/ref.html&gt;.</span>
<span class="c">#</span>
<span class="c"># [van Rossum 2001-07-20b] &quot;Python Library Reference&quot;; Guido van Rossum;</span>
<span class="c"># 2001-07-20; &lt;http://www.python.org/doc/2.1.1/lib/lib.html&gt;.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># B. DOCUMENT HISTORY</span>
<span class="c">#</span>
<span class="c"># 2001-12-04 GDR Created.</span>
<span class="c">#</span>
<span class="c"># 2001-12-06 GDR Added command-line interface and source code</span>
<span class="c"># annotation.</span>
<span class="c">#</span>
<span class="c"># 2001-12-09 GDR Moved design and interface to separate documents.</span>
<span class="c">#</span>
<span class="c"># 2001-12-10 GDR Open cache file as binary on Windows.  Allow</span>
<span class="c"># simultaneous -e and -x, or -a and -r.</span>
<span class="c">#</span>
<span class="c"># 2001-12-12 GDR Added command-line help.  Cache analysis so that it</span>
<span class="c"># only needs to be done once when you specify -a and -r.</span>
<span class="c">#</span>
<span class="c"># 2001-12-13 GDR Improved speed while recording.  Portable between</span>
<span class="c"># Python 1.5.2 and 2.1.1.</span>
<span class="c">#</span>
<span class="c"># 2002-01-03 GDR Module-level functions work correctly.</span>
<span class="c">#</span>
<span class="c"># 2002-01-07 GDR Update sys.path when running a file with the -x option,</span>
<span class="c"># so that it matches the value the program would get if it were run on</span>
<span class="c"># its own.</span>
<span class="c">#</span>
<span class="c"># 2004-12-12 NMB Significant code changes.</span>
<span class="c"># - Finding executable statements has been rewritten so that docstrings and</span>
<span class="c">#   other quirks of Python execution aren&#39;t mistakenly identified as missing</span>
<span class="c">#   lines.</span>
<span class="c"># - Lines can be excluded from consideration, even entire suites of lines.</span>
<span class="c"># - The filesystem cache of covered lines can be disabled programmatically.</span>
<span class="c"># - Modernized the code.</span>
<span class="c">#</span>
<span class="c"># 2004-12-14 NMB Minor tweaks.  Return &#39;analysis&#39; to its original behavior</span>
<span class="c"># and add &#39;analysis2&#39;.  Add a global for &#39;annotate&#39;, and factor it, adding</span>
<span class="c"># &#39;annotate_file&#39;.</span>
<span class="c">#</span>
<span class="c"># 2004-12-31 NMB Allow for keyword arguments in the module global functions.</span>
<span class="c"># Thanks, Allen.</span>
<span class="c">#</span>
<span class="c"># 2005-12-02 NMB Call threading.settrace so that all threads are measured.</span>
<span class="c"># Thanks Martin Fuzzey. Add a file argument to report so that reports can be </span>
<span class="c"># captured to a different destination.</span>
<span class="c">#</span>
<span class="c"># 2005-12-03 NMB coverage.py can now measure itself.</span>
<span class="c">#</span>
<span class="c"># 2005-12-04 NMB Adapted Greg Rogers&#39; patch for using relative filenames,</span>
<span class="c"># and sorting and omitting files to report on.</span>
<span class="c">#</span>
<span class="c"># 2006-07-23 NMB Applied Joseph Tate&#39;s patch for function decorators.</span>
<span class="c">#</span>
<span class="c"># 2006-08-21 NMB Applied Sigve Tjora and Mark van der Wal&#39;s fixes for argument</span>
<span class="c"># handling.</span>
<span class="c">#</span>
<span class="c"># 2006-08-22 NMB Applied Geoff Bache&#39;s parallel mode patch.</span>
<span class="c">#</span>
<span class="c"># 2006-08-23 NMB Refactorings to improve testability.  Fixes to command-line</span>
<span class="c"># logic for parallel mode and collect.</span>
<span class="c">#</span>
<span class="c"># 2006-08-25 NMB &quot;#pragma: nocover&quot; is excluded by default.</span>
<span class="c">#</span>
<span class="c"># 2006-09-10 NMB Properly ignore docstrings and other constant expressions that</span>
<span class="c"># appear in the middle of a function, a problem reported by Tim Leslie.</span>
<span class="c"># Minor changes to avoid lint warnings.</span>
<span class="c">#</span>
<span class="c"># 2006-09-17 NMB coverage.erase() shouldn&#39;t clobber the exclude regex.</span>
<span class="c"># Change how parallel mode is invoked, and fix erase() so that it erases the</span>
<span class="c"># cache when called programmatically.</span>
<span class="c">#</span>
<span class="c"># 2007-07-21 NMB In reports, ignore code executed from strings, since we can&#39;t</span>
<span class="c"># do anything useful with it anyway.</span>
<span class="c"># Better file handling on Linux, thanks Guillaume Chazarain.</span>
<span class="c"># Better shell support on Windows, thanks Noel O&#39;Boyle.</span>
<span class="c"># Python 2.2 support maintained, thanks Catherine Proulx.</span>
<span class="c">#</span>
<span class="c"># 2007-07-22 NMB Python 2.5 now fully supported. The method of dealing with</span>
<span class="c"># multi-line statements is now less sensitive to the exact line that Python</span>
<span class="c"># reports during execution. Pass statements are handled specially so that their</span>
<span class="c"># disappearance during execution won&#39;t throw off the measurement.</span>
<span class="c">#</span>
<span class="c"># 2007-07-23 NMB Now Python 2.5 is *really* fully supported: the body of the</span>
<span class="c"># new with statement is counted as executable.</span>
<span class="c">#</span>
<span class="c"># 2007-07-29 NMB Better packaging.</span>
<span class="c">#</span>
<span class="c"># 2007-09-13 EDL Open Python files with &#39;rU&#39; mode.</span>
<span class="c">#</span>
<span class="c"># 2007-09-20 EDL Added DefInfo, which gives fine-grained info about</span>
<span class="c"># coverage (and location) of functions &amp; classes.</span>

<span class="c"># C. COPYRIGHT AND LICENCE</span>
<span class="c">#</span>
<span class="c"># Copyright 2001 Gareth Rees.  All rights reserved.</span>
<span class="c"># Copyright 2004-2007 Ned Batchelder.  All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions are</span>
<span class="c"># met:</span>
<span class="c">#</span>
<span class="c"># 1. Redistributions of source code must retain the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer.</span>
<span class="c">#</span>
<span class="c"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer in the</span>
<span class="c">#    documentation and/or other materials provided with the</span>
<span class="c">#    distribution.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c"># HOLDERS AND CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="c"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<span class="c"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</span>
<span class="c"># OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<span class="c"># ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</span>
<span class="c"># TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE</span>
<span class="c"># USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<span class="c"># DAMAGE.</span>
<span class="c">#</span>
<span class="c"># $Id: coverage.py 74 2007-07-29 22:28:35Z nedbat $</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">NLTK News</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2011, Steven Bird.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>